import{t as J,a as U,b as qt}from"./FYrJzXzo.js";import"./CM28Q3F9.js";import{v as yt,p as Tt,g as e,d as M,s as w,l as bt,h as mt,j as Bt,aB as kt,c as Q,b as S,r as V,t as st,a as Rt,e as vt,f as Ot,m as _t,n as Et}from"./BWQv4ORO.js";import{e as _}from"./DGJXvoP4.js";import{p as g,i as it,s as Ut,b as Zt}from"./Agn4hVUl.js";import{s as $}from"./DbZDx95u.js";import{t as Yt,s as rt,i as ft,c as Pt,a as Mt,n as Gt,r as At,g as Xt}from"./KVacng_F.js";import{b as ct}from"./BQZnyJ-a.js";import{i as Wt}from"./aOCAfh_U.js";import{c as zt}from"./eV_I911L.js";import{u as Kt}from"./C4a1ezua.js";import{c as St,o as Jt,a as Qt}from"./Dnl6xlxb.js";function xt(a,t,s,o){var i=a.__style;if(yt||i!==t){var h=Yt(t);(!yt||h!==a.getAttribute("style"))&&(h==null?a.removeAttribute("style"):a.style.cssText=h),a.__style=t}return o}function gt(a){return function(...t){var s=t[0];return s.preventDefault(),a==null?void 0:a.apply(this,t)}}function Dt(a,t,s){return a>=t*s?{width:t*s,height:t}:{width:a,height:a/s}}function pt(a,t,s,o){return{x:It(a.x,t.width,s.width,o),y:It(a.y,t.height,s.height,o)}}function It(a,t,s,o){const i=t*o/2-s/2;return Math.min(i,Math.max(a,-i))}function Lt(a,t){return Math.sqrt(Math.pow(a.y-t.y,2)+Math.pow(a.x-t.x,2))}function Vt(a,t,s,o,i,h=!0){const d=h?$t:te,E={x:d(100,((t.width-s.width/i)/2-a.x/i)/t.width*100),y:d(100,((t.height-s.height/i)/2-a.y/i)/t.height*100),width:d(100,s.width/t.width*100/i),height:d(100,s.height/t.height*100/i)},m=d(t.naturalWidth,E.width*t.naturalWidth/100,!0),b=d(t.naturalHeight,E.height*t.naturalHeight/100,!0),D=t.naturalWidth>=t.naturalHeight*o?{width:Math.round(b*o),height:b}:{width:m,height:Math.round(m/o)},Z={...D,x:d(t.naturalWidth-D.width,E.x*t.naturalWidth/100,!0),y:d(t.naturalHeight-D.height,E.y*t.naturalHeight/100,!0)};return{croppedAreaPercentages:E,croppedAreaPixels:Z}}function $t(a,t,s=!1){const o=s?Math.round(t):t;return Math.min(a,Math.max(0,o))}function te(a,t){return t}function Ct(a,t){return{x:(t.x+a.x)/2,y:(t.y+a.y)/2}}const ee=a=>new Promise((t,s)=>{const o=new Image;o.addEventListener("load",()=>t(o)),o.addEventListener("error",i=>s(i)),o.setAttribute("crossOrigin","anonymous"),o.src=a});function jt(a){return a*Math.PI/180}function ne(a,t,s){const o=jt(s);return{width:Math.abs(Math.cos(o)*a)+Math.abs(Math.sin(o)*t),height:Math.abs(Math.sin(o)*a)+Math.abs(Math.cos(o)*t)}}async function ae(a,t,s=0,o={horizontal:!1,vertical:!1}){const i=await ee(a),h=document.createElement("canvas"),d=h.getContext("2d");if(!d)return null;const E=jt(s),{width:m,height:b}=ne(i.width,i.height,s);h.width=m,h.height=b,d.translate(m/2,b/2),d.rotate(E),d.scale(o.horizontal?-1:1,o.vertical?-1:1),d.translate(-i.width/2,-i.height/2),d.drawImage(i,0,0);const H=d.getImageData(t.x,t.y,t.width,t.height);return h.width=t.width,h.height=t.height,d.putImageData(H,0,0),new Promise((D,Z)=>{h.toBlob(x=>{D(x)},"image/png")})}var oe=J('<div data-testid="cropper"></div>'),ie=J('<div class="cr-container svelte-1oj6xfn" data-testid="cr-container"><img class="cr-image svelte-1oj6xfn" alt=""> <!></div>');function re(a,t){Tt(t,!1);let s=g(t,"image",8),o=g(t,"crop",28,()=>({x:0,y:0})),i=g(t,"zoom",12,1),h=g(t,"aspect",8,4/3),d=g(t,"minZoom",8,1),E=g(t,"maxZoom",8,3),m=g(t,"cropSize",8,null),b=g(t,"cropShape",8,"rect"),H=g(t,"showGrid",8,!0),D=g(t,"zoomSpeed",8,1),Z=g(t,"crossOrigin",8,null),x=g(t,"restrictPosition",8,!0),p=M(null),T={width:0,height:0,naturalWidth:0,naturalHeight:0},y=M(null),P=null,l=M(null),k={x:0,y:0},Y={x:0,y:0},G=0,R=null,N=null;const lt=St();Jt(()=>{e(l)&&e(l).complete&&tt(),e(y)&&(e(y).addEventListener("gesturestart",q),e(y).addEventListener("gesturechange",q))}),Qt(()=>{e(y)&&(e(y).removeEventListener("gesturestart",q),e(y).removeEventListener("gesturechange",q)),I()});const q=n=>n.preventDefault(),I=()=>{typeof document<"u"&&(document.removeEventListener("mousemove",nt),document.removeEventListener("mouseup",c),document.removeEventListener("touchmove",at),document.removeEventListener("touchend",c))},tt=()=>{et(),dt()},ut=()=>m()?m().width/m().height:h(),et=()=>{e(l)&&(T={width:e(l).width,height:e(l).height,naturalWidth:e(l).naturalWidth,naturalHeight:e(l).naturalHeight},w(p,m()?m():Dt(e(l).width,e(l).height,h()))),e(y)&&(P=e(y).getBoundingClientRect())},X=n=>({x:Number(n.clientX),y:Number(n.clientY)}),W=n=>({x:Number(n.clientX),y:Number(n.clientY)}),j=n=>{document.addEventListener("mousemove",nt),document.addEventListener("mouseup",c),z(X(n))},nt=n=>r(X(n)),ht=n=>{document.addEventListener("touchmove",at,{passive:!1}),document.addEventListener("touchend",c),n.touches.length===2?f(n):n.touches.length===1&&z(W(n.touches[0]))},at=n=>{n.preventDefault(),n.touches.length===2?A(n):n.touches.length===1&&r(W(n.touches[0]))},z=({x:n,y:u})=>{k={x:n,y:u},Y={x:o().x,y:o().y}},r=({x:n,y:u})=>{R&&window.cancelAnimationFrame(R),R=window.requestAnimationFrame(()=>{if(n===void 0||u===void 0||!e(p))return;const v=n-k.x,C=u-k.y,F={x:Y.x+v,y:Y.y+C};o(x()?pt(F,T,e(p),i()):F)})},c=()=>{I(),dt()},f=n=>{const u=W(n.touches[0]),v=W(n.touches[1]);G=Lt(u,v),z(Ct(u,v))},A=n=>{const u=W(n.touches[0]),v=W(n.touches[1]),C=Ct(u,v);r(C),N&&window.cancelAnimationFrame(N),N=window.requestAnimationFrame(()=>{const F=Lt(u,v),Nt=i()*(F/G);wt(Nt,C),G=F})},L=n=>{const u=X(n),v=i()-n.deltaY*D()/200;wt(v,u)},ot=({x:n,y:u})=>{if(!P)throw new Error("The Cropper is not mounted");return{x:P.width/2-(n-P.left),y:P.height/2-(u-P.top)}},B=({x:n,y:u})=>({x:(n+o().x)/i(),y:(u+o().y)/i()}),wt=(n,u)=>{if(!e(p))return;const v=ot(u),C=B(v);i(Math.min(E(),Math.max(n,d())));const F={x:C.x*i()-v.x,y:C.y*i()-v.y};o(x()?pt(F,T,e(p),i()):F)},dt=()=>{if(!e(p)||e(p).width===0)return;const n=x()?pt(o(),T,e(p),i()):o(),{croppedAreaPercentages:u,croppedAreaPixels:v}=Vt(n,T,e(p),ut(),i(),x());lt("cropcomplete",{percent:u,pixels:v})};bt(()=>(e(l),mt(m()),mt(h())),()=>{e(l)&&w(p,m()?m():Dt(e(l).width,e(l).height,h()))}),bt(()=>mt(i()),()=>{i()&&dt()}),Bt(),Wt();var O=ie();_("resize",kt,et);var K=Q(O);ct(K,n=>w(l,n),()=>e(l));var Ft=S(K,2);{var Ht=n=>{var u=oe();let v;st(C=>{v=rt(u,1,"cr-area svelte-1oj6xfn",null,v,C),xt(u,`width: ${e(p).width??""}px; height: ${e(p).height??""}px;`)},[()=>({"cr-round":b()==="cr-round","cr-grid":H()})],vt),U(n,u)};it(Ft,n=>{e(p)&&n(Ht)})}V(O),ct(O,n=>w(y,n),()=>e(y)),st(()=>{$(K,"src",s()),xt(K,`transform: translate(${o().x??""}px, ${o().y??""}px) scale(${i()??""});`),$(K,"crossorigin",Z())}),_("load",K,tt),_("mousedown",O,gt(j)),_("touchstart",O,gt(ht)),_("wheel",O,gt(L)),U(a,O),Rt()}var se=J('<span class="text-[#EF174C]">ATTENTION:</span> Use Google Chrome, Firefox, oder Microsoft Edge for optimized image quality and size.',1),ce=J('<div class="flex space-x-4 z-[60] fixed bottom-0 right-0 left-0 p-6"><div class="flex-1"></div> <button class="bg-[#EF174C] text-white rounded-full px-4 py-2">Confirm</button> <button class="bg-white text-black rounded-full px-4 py-2">Cancel</button> <div class="flex-1"></div></div>'),le=J('<button class="w-full h-full p-0 m-0 border-0 bg-transparent" aria-label="Select image to upload"><img></button>'),ue=J('<div role="region" aria-label="Image cropping overlay"><!></div> <!> <div role="button" tabindex="0" aria-label="Upload or confirm image"><!></div> <input class="w-px h-px opacity-0 fixed -top-40" type="file" accept="image/*" name="imagefile">',1);function Ee(a,t){Tt(t,!1);const[s,o]=Ut(),i=()=>Zt(zt,"$currentUser",s);let h=g(t,"src",12),d=g(t,"alt",8),E=g(t,"uploadPrompt",8,void 0),m=g(t,"maxWidth",8),b=g(t,"maxHeight",8),H=g(t,"quality",8),D=g(t,"class",8,"");function Z(r){e(l)&&r.key==="Escape"?R():e(l)&&r.key==="Enter"&&N()}let x=M(),p,T=M(),y=M(),P=M(),l=M(!1),k=M(1),Y=M({x:0,y:0}),G=M(1);function R(){w(l,!1),w(y,void 0),_t(x,e(x).value=null),w(k,1)}async function N(){const r=e(x).files[0],c=ft()?"image/jpeg":"image/webp",f=ft()?"jpg":"webp",A=[["images",Gt()].join("/"),f].join(".");let L;if(e(P)&&e(P).pixels){const B=await ae(e(y),e(P).pixels);L=await At(B,m(),b(),H(),c)}else L=await At(r,m(),b(),H(),c);const ot=new File([L],`${r.name.split(".")[0]}.${f}`,{type:c});p=0;try{i()?(await Kt(ot,A,B=>{p=B}),h(`/assets/${A}`)):h(URL.createObjectURL(ot)),p=void 0}catch(B){console.error(B),alert("An error occured. Please try again"),p=void 0}R(),_t(x,e(x).value=null)}async function lt(){const r=e(x).files[0],{width:c,height:f}=await Xt(r),A=c/f,L=m()/b();L>A?w(k,L/A):w(k,A/L),w(y,URL.createObjectURL(r)),w(l,!0)}Wt();var q=ue();_("keydown",kt,Z);var I=Ot(q),tt=Q(I);{var ut=r=>{var c=se();Et(),U(r,c)},et=r=>{var c=qt("Confirm with ENTER. Cancel with ESC.");U(r,c)};it(tt,r=>{ft()?r(ut):r(et,!1)})}V(I),ct(I,r=>w(T,r),()=>e(T));var X=S(I,2);{var W=r=>{var c=ce(),f=S(Q(c),2),A=S(f,2);Et(2),V(c),_("click",f,N),_("click",A,R),U(r,c)};it(X,r=>{e(l)&&r(W)})}var j=S(X,2),nt=Q(j);{var ht=r=>{const c=vt(()=>m()/b());re(r,{get image(){return e(y)},get aspect(){return e(c)},get crop(){return e(Y)},set crop(f){w(Y,f)},get zoom(){return e(G)},set zoom(f){w(G,f)},$$events:{cropcomplete:f=>w(P,f.detail)},$$legacy:!0})},at=r=>{var c=le(),f=Q(c);V(c),st(()=>{rt(f,1,D()+" cursor-pointer outline-[2px] hover:outline-dashed outline-[#EF174C] -outline-offset-[2px]"),$(f,"src",h()),$(f,"alt",d()),$(f,"title",E())}),_("click",c,()=>e(x).click()),U(r,c)};it(nt,r=>{e(l)?r(ht):r(at,!1)})}V(j);var z=S(j,2);ct(z,r=>w(x,r),()=>e(x)),st((r,c)=>{rt(I,1,r),xt(j,`aspect-ratio: ${m()}/${b()}; scale: ${e(k)}`),rt(j,1,c)},[()=>Pt(Mt(e(l)?"z-40 bg-black text-white font-bold fixed inset-0 bg-opacity-80 text-center p-6":"hidden")),()=>Pt(Mt(e(l)?"z-50":"","relative"))],vt),_("dblclick",I,R),_("dblclick",j,N),_("change",z,lt),U(a,q),Rt(),o()}export{Ee as default};
