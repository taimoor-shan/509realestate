function M(s){this.content=s}M.prototype={constructor:M,find:function(s){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===s)return e;return-1},get:function(s){var e=this.find(s);return e==-1?void 0:this.content[e+1]},update:function(s,e,t){var n=t&&t!=s?this.remove(t):this,r=n.find(s),i=n.content.slice();return r==-1?i.push(t||s,e):(i[r+1]=e,t&&(i[r]=t)),new M(i)},remove:function(s){var e=this.find(s);if(e==-1)return this;var t=this.content.slice();return t.splice(e,2),new M(t)},addToStart:function(s,e){return new M([s,e].concat(this.remove(s).content))},addToEnd:function(s,e){var t=this.remove(s).content.slice();return t.push(s,e),new M(t)},addBefore:function(s,e,t){var n=this.remove(e),r=n.content.slice(),i=n.find(s);return r.splice(i==-1?r.length:i,0,e,t),new M(r)},forEach:function(s){for(var e=0;e<this.content.length;e+=2)s(this.content[e],this.content[e+1])},prepend:function(s){return s=M.from(s),s.size?new M(s.content.concat(this.subtract(s).content)):this},append:function(s){return s=M.from(s),s.size?new M(this.subtract(s).content.concat(s.content)):this},subtract:function(s){var e=this;s=M.from(s);for(var t=0;t<s.content.length;t+=2)e=e.remove(s.content[t]);return e},toObject:function(){var s={};return this.forEach(function(e,t){s[e]=t}),s},get size(){return this.content.length>>1}};M.from=function(s){if(s instanceof M)return s;var e=[];if(s)for(var t in s)e.push(t,s[t]);return new M(e)};function lt(s,e,t){for(let n=0;;n++){if(n==s.childCount||n==e.childCount)return s.childCount==e.childCount?null:t;let r=s.child(n),i=e.child(n);if(r==i){t+=r.nodeSize;continue}if(!r.sameMarkup(i))return t;if(r.isText&&r.text!=i.text){for(let l=0;r.text[l]==i.text[l];l++)t++;return t}if(r.content.size||i.content.size){let l=lt(r.content,i.content,t+1);if(l!=null)return l}t+=r.nodeSize}}function ot(s,e,t,n){for(let r=s.childCount,i=e.childCount;;){if(r==0||i==0)return r==i?null:{a:t,b:n};let l=s.child(--r),o=e.child(--i),a=l.nodeSize;if(l==o){t-=a,n-=a;continue}if(!l.sameMarkup(o))return{a:t,b:n};if(l.isText&&l.text!=o.text){let h=0,f=Math.min(l.text.length,o.text.length);for(;h<f&&l.text[l.text.length-h-1]==o.text[o.text.length-h-1];)h++,t--,n--;return{a:t,b:n}}if(l.content.size||o.content.size){let h=ot(l.content,o.content,t-1,n-1);if(h)return h}t-=a,n-=a}}class m{constructor(e,t){if(this.content=e,this.size=t||0,t==null)for(let n=0;n<e.length;n++)this.size+=e[n].nodeSize}nodesBetween(e,t,n,r=0,i){for(let l=0,o=0;o<t;l++){let a=this.content[l],h=o+a.nodeSize;if(h>e&&n(a,r+o,i||null,l)!==!1&&a.content.size){let f=o+1;a.nodesBetween(Math.max(0,e-f),Math.min(a.content.size,t-f),n,r+f)}o=h}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,t,n,r){let i="",l=!0;return this.nodesBetween(e,t,(o,a)=>{let h=o.isText?o.text.slice(Math.max(e,a)-a,t-a):o.isLeaf?r?typeof r=="function"?r(o):r:o.type.spec.leafText?o.type.spec.leafText(o):"":"";o.isBlock&&(o.isLeaf&&h||o.isTextblock)&&n&&(l?l=!1:i+=n),i+=h},0),i}append(e){if(!e.size)return this;if(!this.size)return e;let t=this.lastChild,n=e.firstChild,r=this.content.slice(),i=0;for(t.isText&&t.sameMarkup(n)&&(r[r.length-1]=t.withText(t.text+n.text),i=1);i<e.content.length;i++)r.push(e.content[i]);return new m(r,this.size+e.size)}cut(e,t=this.size){if(e==0&&t==this.size)return this;let n=[],r=0;if(t>e)for(let i=0,l=0;l<t;i++){let o=this.content[i],a=l+o.nodeSize;a>e&&((l<e||a>t)&&(o.isText?o=o.cut(Math.max(0,e-l),Math.min(o.text.length,t-l)):o=o.cut(Math.max(0,e-l-1),Math.min(o.content.size,t-l-1))),n.push(o),r+=o.nodeSize),l=a}return new m(n,r)}cutByIndex(e,t){return e==t?m.empty:e==0&&t==this.content.length?this:new m(this.content.slice(e,t))}replaceChild(e,t){let n=this.content[e];if(n==t)return this;let r=this.content.slice(),i=this.size+t.nodeSize-n.nodeSize;return r[e]=t,new m(r,i)}addToStart(e){return new m([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new m(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let t=0;t<this.content.length;t++)if(!this.content[t].eq(e.content[t]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let t=this.content[e];if(!t)throw new RangeError("Index "+e+" out of range for "+this);return t}maybeChild(e){return this.content[e]||null}forEach(e){for(let t=0,n=0;t<this.content.length;t++){let r=this.content[t];e(r,n,t),n+=r.nodeSize}}findDiffStart(e,t=0){return lt(this,e,t)}findDiffEnd(e,t=this.size,n=e.size){return ot(this,e,t,n)}findIndex(e,t=-1){if(e==0)return te(0,e);if(e==this.size)return te(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let n=0,r=0;;n++){let i=this.child(n),l=r+i.nodeSize;if(l>=e)return l==e||t>0?te(n+1,l):te(n,r);r=l}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,t){if(!t)return m.empty;if(!Array.isArray(t))throw new RangeError("Invalid input for Fragment.fromJSON");return new m(t.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return m.empty;let t,n=0;for(let r=0;r<e.length;r++){let i=e[r];n+=i.nodeSize,r&&i.isText&&e[r-1].sameMarkup(i)?(t||(t=e.slice(0,r)),t[t.length-1]=i.withText(t[t.length-1].text+i.text)):t&&t.push(i)}return new m(t||e,n)}static from(e){if(!e)return m.empty;if(e instanceof m)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new m([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}m.empty=new m([],0);const ye={index:0,offset:0};function te(s,e){return ye.index=s,ye.offset=e,ye}function le(s,e){if(s===e)return!0;if(!(s&&typeof s=="object")||!(e&&typeof e=="object"))return!1;let t=Array.isArray(s);if(Array.isArray(e)!=t)return!1;if(t){if(s.length!=e.length)return!1;for(let n=0;n<s.length;n++)if(!le(s[n],e[n]))return!1}else{for(let n in s)if(!(n in e)||!le(s[n],e[n]))return!1;for(let n in e)if(!(n in s))return!1}return!0}class k{constructor(e,t){this.type=e,this.attrs=t}addToSet(e){let t,n=!1;for(let r=0;r<e.length;r++){let i=e[r];if(this.eq(i))return e;if(this.type.excludes(i.type))t||(t=e.slice(0,r));else{if(i.type.excludes(this.type))return e;!n&&i.type.rank>this.type.rank&&(t||(t=e.slice(0,r)),t.push(this),n=!0),t&&t.push(i)}}return t||(t=e.slice()),n||t.push(this),t}removeFromSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return e.slice(0,t).concat(e.slice(t+1));return e}isInSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return!0;return!1}eq(e){return this==e||this.type==e.type&&le(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Mark.fromJSON");let n=e.marks[t.type];if(!n)throw new RangeError(`There is no mark type ${t.type} in this schema`);let r=n.create(t.attrs);return n.checkAttrs(r.attrs),r}static sameSet(e,t){if(e==t)return!0;if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].eq(t[n]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return k.none;if(e instanceof k)return[e];let t=e.slice();return t.sort((n,r)=>n.type.rank-r.type.rank),t}}k.none=[];class oe extends Error{}class y{constructor(e,t,n){this.content=e,this.openStart=t,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,t){let n=ht(this.content,e+this.openStart,t);return n&&new y(n,this.openStart,this.openEnd)}removeBetween(e,t){return new y(at(this.content,e+this.openStart,t+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,t){if(!t)return y.empty;let n=t.openStart||0,r=t.openEnd||0;if(typeof n!="number"||typeof r!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new y(m.fromJSON(e,t.content),n,r)}static maxOpen(e,t=!0){let n=0,r=0;for(let i=e.firstChild;i&&!i.isLeaf&&(t||!i.type.spec.isolating);i=i.firstChild)n++;for(let i=e.lastChild;i&&!i.isLeaf&&(t||!i.type.spec.isolating);i=i.lastChild)r++;return new y(e,n,r)}}y.empty=new y(m.empty,0,0);function at(s,e,t){let{index:n,offset:r}=s.findIndex(e),i=s.maybeChild(n),{index:l,offset:o}=s.findIndex(t);if(r==e||i.isText){if(o!=t&&!s.child(l).isText)throw new RangeError("Removing non-flat range");return s.cut(0,e).append(s.cut(t))}if(n!=l)throw new RangeError("Removing non-flat range");return s.replaceChild(n,i.copy(at(i.content,e-r-1,t-r-1)))}function ht(s,e,t,n){let{index:r,offset:i}=s.findIndex(e),l=s.maybeChild(r);if(i==e||l.isText)return s.cut(0,e).append(t).append(s.cut(e));let o=ht(l.content,e-i-1,t);return o&&s.replaceChild(r,l.copy(o))}function jt(s,e,t){if(t.openStart>s.depth)throw new oe("Inserted content deeper than insertion position");if(s.depth-t.openStart!=e.depth-t.openEnd)throw new oe("Inconsistent open depths");return ft(s,e,t,0)}function ft(s,e,t,n){let r=s.index(n),i=s.node(n);if(r==e.index(n)&&n<s.depth-t.openStart){let l=ft(s,e,t,n+1);return i.copy(i.content.replaceChild(r,l))}else if(t.content.size)if(!t.openStart&&!t.openEnd&&s.depth==n&&e.depth==n){let l=s.parent,o=l.content;return W(l,o.cut(0,s.parentOffset).append(t.content).append(o.cut(e.parentOffset)))}else{let{start:l,end:o}=Ht(t,s);return W(i,ut(s,l,o,e,n))}else return W(i,ae(s,e,n))}function ct(s,e){if(!e.type.compatibleContent(s.type))throw new oe("Cannot join "+e.type.name+" onto "+s.type.name)}function Ee(s,e,t){let n=s.node(t);return ct(n,e.node(t)),n}function P(s,e){let t=e.length-1;t>=0&&s.isText&&s.sameMarkup(e[t])?e[t]=s.withText(e[t].text+s.text):e.push(s)}function Y(s,e,t,n){let r=(e||s).node(t),i=0,l=e?e.index(t):r.childCount;s&&(i=s.index(t),s.depth>t?i++:s.textOffset&&(P(s.nodeAfter,n),i++));for(let o=i;o<l;o++)P(r.child(o),n);e&&e.depth==t&&e.textOffset&&P(e.nodeBefore,n)}function W(s,e){return s.type.checkContent(e),s.copy(e)}function ut(s,e,t,n,r){let i=s.depth>r&&Ee(s,e,r+1),l=n.depth>r&&Ee(t,n,r+1),o=[];return Y(null,s,r,o),i&&l&&e.index(r)==t.index(r)?(ct(i,l),P(W(i,ut(s,e,t,n,r+1)),o)):(i&&P(W(i,ae(s,e,r+1)),o),Y(e,t,r,o),l&&P(W(l,ae(t,n,r+1)),o)),Y(n,null,r,o),new m(o)}function ae(s,e,t){let n=[];if(Y(null,s,t,n),s.depth>t){let r=Ee(s,e,t+1);P(W(r,ae(s,e,t+1)),n)}return Y(e,null,t,n),new m(n)}function Ht(s,e){let t=e.depth-s.openStart,r=e.node(t).copy(s.content);for(let i=t-1;i>=0;i--)r=e.node(i).copy(m.from(r));return{start:r.resolveNoCache(s.openStart+t),end:r.resolveNoCache(r.content.size-s.openEnd-t)}}class Z{constructor(e,t,n){this.pos=e,this.path=t,this.parentOffset=n,this.depth=t.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,t=this.index(this.depth);if(t==e.childCount)return null;let n=this.pos-this.path[this.path.length-1],r=e.child(t);return n?e.child(t).cut(n):r}get nodeBefore(){let e=this.index(this.depth),t=this.pos-this.path[this.path.length-1];return t?this.parent.child(e).cut(0,t):e==0?null:this.parent.child(e-1)}posAtIndex(e,t){t=this.resolveDepth(t);let n=this.path[t*3],r=t==0?0:this.path[t*3-1]+1;for(let i=0;i<e;i++)r+=n.child(i).nodeSize;return r}marks(){let e=this.parent,t=this.index();if(e.content.size==0)return k.none;if(this.textOffset)return e.child(t).marks;let n=e.maybeChild(t-1),r=e.maybeChild(t);if(!n){let o=n;n=r,r=o}let i=n.marks;for(var l=0;l<i.length;l++)i[l].type.spec.inclusive===!1&&(!r||!i[l].isInSet(r.marks))&&(i=i[l--].removeFromSet(i));return i}marksAcross(e){let t=this.parent.maybeChild(this.index());if(!t||!t.isInline)return null;let n=t.marks,r=e.parent.maybeChild(e.index());for(var i=0;i<n.length;i++)n[i].type.spec.inclusive===!1&&(!r||!n[i].isInSet(r.marks))&&(n=n[i--].removeFromSet(n));return n}sharedDepth(e){for(let t=this.depth;t>0;t--)if(this.start(t)<=e&&this.end(t)>=e)return t;return 0}blockRange(e=this,t){if(e.pos<this.pos)return e.blockRange(this);for(let n=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);n>=0;n--)if(e.pos<=this.end(n)&&(!t||t(this.node(n))))return new Te(this,e,n);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let t=1;t<=this.depth;t++)e+=(e?"/":"")+this.node(t).type.name+"_"+this.index(t-1);return e+":"+this.parentOffset}static resolve(e,t){if(!(t>=0&&t<=e.content.size))throw new RangeError("Position "+t+" out of range");let n=[],r=0,i=t;for(let l=e;;){let{index:o,offset:a}=l.content.findIndex(i),h=i-a;if(n.push(l,o,r+a),!h||(l=l.child(o),l.isText))break;i=h-1,r+=a+1}return new Z(t,n,i)}static resolveCached(e,t){let n=Le.get(e);if(n)for(let i=0;i<n.elts.length;i++){let l=n.elts[i];if(l.pos==t)return l}else Le.set(e,n=new Gt);let r=n.elts[n.i]=Z.resolve(e,t);return n.i=(n.i+1)%Kt,r}}class Gt{constructor(){this.elts=[],this.i=0}}const Kt=12,Le=new WeakMap;class Te{constructor(e,t,n){this.$from=e,this.$to=t,this.depth=n}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const Qt=Object.create(null);class z{constructor(e,t,n,r=k.none){this.type=e,this.attrs=t,this.marks=r,this.content=n||m.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,t,n,r=0){this.content.nodesBetween(e,t,n,r,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,t,n,r){return this.content.textBetween(e,t,n,r)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,t,n){return this.type==e&&le(this.attrs,t||e.defaultAttrs||Qt)&&k.sameSet(this.marks,n||k.none)}copy(e=null){return e==this.content?this:new z(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new z(this.type,this.attrs,this.content,e)}cut(e,t=this.content.size){return e==0&&t==this.content.size?this:this.copy(this.content.cut(e,t))}slice(e,t=this.content.size,n=!1){if(e==t)return y.empty;let r=this.resolve(e),i=this.resolve(t),l=n?0:r.sharedDepth(t),o=r.start(l),h=r.node(l).content.cut(r.pos-o,i.pos-o);return new y(h,r.depth-l,i.depth-l)}replace(e,t,n){return jt(this.resolve(e),this.resolve(t),n)}nodeAt(e){for(let t=this;;){let{index:n,offset:r}=t.content.findIndex(e);if(t=t.maybeChild(n),!t)return null;if(r==e||t.isText)return t;e-=r+1}}childAfter(e){let{index:t,offset:n}=this.content.findIndex(e);return{node:this.content.maybeChild(t),index:t,offset:n}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:t,offset:n}=this.content.findIndex(e);if(n<e)return{node:this.content.child(t),index:t,offset:n};let r=this.content.child(t-1);return{node:r,index:t-1,offset:n-r.nodeSize}}resolve(e){return Z.resolveCached(this,e)}resolveNoCache(e){return Z.resolve(this,e)}rangeHasMark(e,t,n){let r=!1;return t>e&&this.nodesBetween(e,t,i=>(n.isInSet(i.marks)&&(r=!0),!r)),r}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),pt(this.marks,e)}contentMatchAt(e){let t=this.type.contentMatch.matchFragment(this.content,0,e);if(!t)throw new Error("Called contentMatchAt on a node with invalid content");return t}canReplace(e,t,n=m.empty,r=0,i=n.childCount){let l=this.contentMatchAt(e).matchFragment(n,r,i),o=l&&l.matchFragment(this.content,t);if(!o||!o.validEnd)return!1;for(let a=r;a<i;a++)if(!this.type.allowsMarks(n.child(a).marks))return!1;return!0}canReplaceWith(e,t,n,r){if(r&&!this.type.allowsMarks(r))return!1;let i=this.contentMatchAt(e).matchType(n),l=i&&i.matchFragment(this.content,t);return l?l.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=k.none;for(let t=0;t<this.marks.length;t++){let n=this.marks[t];n.type.checkAttrs(n.attrs),e=n.addToSet(e)}if(!k.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(t=>t.type.name)}`);this.content.forEach(t=>t.check())}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(t=>t.toJSON())),e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Node.fromJSON");let n;if(t.marks){if(!Array.isArray(t.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=t.marks.map(e.markFromJSON)}if(t.type=="text"){if(typeof t.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(t.text,n)}let r=m.fromJSON(e,t.content),i=e.nodeType(t.type).create(t.attrs,r,n);return i.type.checkAttrs(i.attrs),i}}z.prototype.text=void 0;class he extends z{constructor(e,t,n,r){if(super(e,t,null,r),!n)throw new RangeError("Empty text nodes are not allowed");this.text=n}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):pt(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,t){return this.text.slice(e,t)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new he(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new he(this.type,this.attrs,e,this.marks)}cut(e=0,t=this.text.length){return e==0&&t==this.text.length?this:this.withText(this.text.slice(e,t))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function pt(s,e){for(let t=s.length-1;t>=0;t--)e=s[t].type.name+"("+e+")";return e}class L{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,t){let n=new Xt(e,t);if(n.next==null)return L.empty;let r=dt(n);n.next&&n.err("Unexpected trailing text");let i=rn(nn(r));return sn(i,n),i}matchType(e){for(let t=0;t<this.next.length;t++)if(this.next[t].type==e)return this.next[t].next;return null}matchFragment(e,t=0,n=e.childCount){let r=this;for(let i=t;r&&i<n;i++)r=r.matchType(e.child(i).type);return r}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:t}=this.next[e];if(!(t.isText||t.hasRequiredAttrs()))return t}return null}compatible(e){for(let t=0;t<this.next.length;t++)for(let n=0;n<e.next.length;n++)if(this.next[t].type==e.next[n].type)return!0;return!1}fillBefore(e,t=!1,n=0){let r=[this];function i(l,o){let a=l.matchFragment(e,n);if(a&&(!t||a.validEnd))return m.from(o.map(h=>h.createAndFill()));for(let h=0;h<l.next.length;h++){let{type:f,next:c}=l.next[h];if(!(f.isText||f.hasRequiredAttrs())&&r.indexOf(c)==-1){r.push(c);let p=i(c,o.concat(f));if(p)return p}}return null}return i(this,[])}findWrapping(e){for(let n=0;n<this.wrapCache.length;n+=2)if(this.wrapCache[n]==e)return this.wrapCache[n+1];let t=this.computeWrapping(e);return this.wrapCache.push(e,t),t}computeWrapping(e){let t=Object.create(null),n=[{match:this,type:null,via:null}];for(;n.length;){let r=n.shift(),i=r.match;if(i.matchType(e)){let l=[];for(let o=r;o.type;o=o.via)l.push(o.type);return l.reverse()}for(let l=0;l<i.next.length;l++){let{type:o,next:a}=i.next[l];!o.isLeaf&&!o.hasRequiredAttrs()&&!(o.name in t)&&(!r.type||a.validEnd)&&(n.push({match:o.contentMatch,type:o,via:r}),t[o.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function t(n){e.push(n);for(let r=0;r<n.next.length;r++)e.indexOf(n.next[r].next)==-1&&t(n.next[r].next)}return t(this),e.map((n,r)=>{let i=r+(n.validEnd?"*":" ")+" ";for(let l=0;l<n.next.length;l++)i+=(l?", ":"")+n.next[l].type.name+"->"+e.indexOf(n.next[l].next);return i}).join(`
`)}}L.empty=new L(!0);class Xt{constructor(e,t){this.string=e,this.nodeTypes=t,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function dt(s){let e=[];do e.push(Yt(s));while(s.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function Yt(s){let e=[];do e.push(Zt(s));while(s.next&&s.next!=")"&&s.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function Zt(s){let e=tn(s);for(;;)if(s.eat("+"))e={type:"plus",expr:e};else if(s.eat("*"))e={type:"star",expr:e};else if(s.eat("?"))e={type:"opt",expr:e};else if(s.eat("{"))e=_t(s,e);else break;return e}function qe(s){/\D/.test(s.next)&&s.err("Expected number, got '"+s.next+"'");let e=Number(s.next);return s.pos++,e}function _t(s,e){let t=qe(s),n=t;return s.eat(",")&&(s.next!="}"?n=qe(s):n=-1),s.eat("}")||s.err("Unclosed braced range"),{type:"range",min:t,max:n,expr:e}}function en(s,e){let t=s.nodeTypes,n=t[e];if(n)return[n];let r=[];for(let i in t){let l=t[i];l.isInGroup(e)&&r.push(l)}return r.length==0&&s.err("No node type or group '"+e+"' found"),r}function tn(s){if(s.eat("(")){let e=dt(s);return s.eat(")")||s.err("Missing closing paren"),e}else if(/\W/.test(s.next))s.err("Unexpected token '"+s.next+"'");else{let e=en(s,s.next).map(t=>(s.inline==null?s.inline=t.isInline:s.inline!=t.isInline&&s.err("Mixing inline and block content"),{type:"name",value:t}));return s.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function nn(s){let e=[[]];return r(i(s,0),t()),e;function t(){return e.push([])-1}function n(l,o,a){let h={term:a,to:o};return e[l].push(h),h}function r(l,o){l.forEach(a=>a.to=o)}function i(l,o){if(l.type=="choice")return l.exprs.reduce((a,h)=>a.concat(i(h,o)),[]);if(l.type=="seq")for(let a=0;;a++){let h=i(l.exprs[a],o);if(a==l.exprs.length-1)return h;r(h,o=t())}else if(l.type=="star"){let a=t();return n(o,a),r(i(l.expr,a),a),[n(a)]}else if(l.type=="plus"){let a=t();return r(i(l.expr,o),a),r(i(l.expr,a),a),[n(a)]}else{if(l.type=="opt")return[n(o)].concat(i(l.expr,o));if(l.type=="range"){let a=o;for(let h=0;h<l.min;h++){let f=t();r(i(l.expr,a),f),a=f}if(l.max==-1)r(i(l.expr,a),a);else for(let h=l.min;h<l.max;h++){let f=t();n(a,f),r(i(l.expr,a),f),a=f}return[n(a)]}else{if(l.type=="name")return[n(o,void 0,l.value)];throw new Error("Unknown expr type")}}}}function mt(s,e){return e-s}function Ve(s,e){let t=[];return n(e),t.sort(mt);function n(r){let i=s[r];if(i.length==1&&!i[0].term)return n(i[0].to);t.push(r);for(let l=0;l<i.length;l++){let{term:o,to:a}=i[l];!o&&t.indexOf(a)==-1&&n(a)}}}function rn(s){let e=Object.create(null);return t(Ve(s,0));function t(n){let r=[];n.forEach(l=>{s[l].forEach(({term:o,to:a})=>{if(!o)return;let h;for(let f=0;f<r.length;f++)r[f][0]==o&&(h=r[f][1]);Ve(s,a).forEach(f=>{h||r.push([o,h=[]]),h.indexOf(f)==-1&&h.push(f)})})});let i=e[n.join(",")]=new L(n.indexOf(s.length-1)>-1);for(let l=0;l<r.length;l++){let o=r[l][1].sort(mt);i.next.push({type:r[l][0],next:e[o.join(",")]||t(o)})}return i}}function sn(s,e){for(let t=0,n=[s];t<n.length;t++){let r=n[t],i=!r.validEnd,l=[];for(let o=0;o<r.next.length;o++){let{type:a,next:h}=r.next[o];l.push(a.name),i&&!(a.isText||a.hasRequiredAttrs())&&(i=!1),n.indexOf(h)==-1&&n.push(h)}i&&e.err("Only non-generatable nodes ("+l.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function gt(s){let e=Object.create(null);for(let t in s){let n=s[t];if(!n.hasDefault)return null;e[t]=n.default}return e}function yt(s,e){let t=Object.create(null);for(let n in s){let r=e&&e[n];if(r===void 0){let i=s[n];if(i.hasDefault)r=i.default;else throw new RangeError("No value supplied for attribute "+n)}t[n]=r}return t}function wt(s,e,t,n){for(let r in e)if(!(r in s))throw new RangeError(`Unsupported attribute ${r} for ${t} of type ${r}`);for(let r in s){let i=s[r];i.validate&&i.validate(e[r])}}function xt(s,e){let t=Object.create(null);if(e)for(let n in e)t[n]=new on(s,n,e[n]);return t}class fe{constructor(e,t,n){this.name=e,this.schema=t,this.spec=n,this.markSet=null,this.groups=n.group?n.group.split(" "):[],this.attrs=xt(e,n.attrs),this.defaultAttrs=gt(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(n.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==L.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:yt(this.attrs,e)}create(e=null,t,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new z(this,this.computeAttrs(e),m.from(t),k.setFrom(n))}createChecked(e=null,t,n){return t=m.from(t),this.checkContent(t),new z(this,this.computeAttrs(e),t,k.setFrom(n))}createAndFill(e=null,t,n){if(e=this.computeAttrs(e),t=m.from(t),t.size){let l=this.contentMatch.fillBefore(t);if(!l)return null;t=l.append(t)}let r=this.contentMatch.matchFragment(t),i=r&&r.fillBefore(m.empty,!0);return i?new z(this,e,t.append(i),k.setFrom(n)):null}validContent(e){let t=this.contentMatch.matchFragment(e);if(!t||!t.validEnd)return!1;for(let n=0;n<e.childCount;n++)if(!this.allowsMarks(e.child(n).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){wt(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let t=0;t<e.length;t++)if(!this.allowsMarkType(e[t].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let t;for(let n=0;n<e.length;n++)this.allowsMarkType(e[n].type)?t&&t.push(e[n]):t||(t=e.slice(0,n));return t?t.length?t:k.none:e}static compile(e,t){let n=Object.create(null);e.forEach((i,l)=>n[i]=new fe(i,t,l));let r=t.spec.topNode||"doc";if(!n[r])throw new RangeError("Schema is missing its top node type ('"+r+"')");if(!n.text)throw new RangeError("Every schema needs a 'text' type");for(let i in n.text.attrs)throw new RangeError("The text node type should not have attributes");return n}}function ln(s,e,t){let n=t.split("|");return r=>{let i=r===null?"null":typeof r;if(n.indexOf(i)<0)throw new RangeError(`Expected value of type ${n} for attribute ${e} on type ${s}, got ${i}`)}}class on{constructor(e,t,n){this.hasDefault=Object.prototype.hasOwnProperty.call(n,"default"),this.default=n.default,this.validate=typeof n.validate=="string"?ln(e,t,n.validate):n.validate}get isRequired(){return!this.hasDefault}}class pe{constructor(e,t,n,r){this.name=e,this.rank=t,this.schema=n,this.spec=r,this.attrs=xt(e,r.attrs),this.excluded=null;let i=gt(this.attrs);this.instance=i?new k(this,i):null}create(e=null){return!e&&this.instance?this.instance:new k(this,yt(this.attrs,e))}static compile(e,t){let n=Object.create(null),r=0;return e.forEach((i,l)=>n[i]=new pe(i,r++,t,l)),n}removeFromSet(e){for(var t=0;t<e.length;t++)e[t].type==this&&(e=e.slice(0,t).concat(e.slice(t+1)),t--);return e}isInSet(e){for(let t=0;t<e.length;t++)if(e[t].type==this)return e[t]}checkAttrs(e){wt(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}}class ar{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let t=this.spec={};for(let r in e)t[r]=e[r];t.nodes=M.from(e.nodes),t.marks=M.from(e.marks||{}),this.nodes=fe.compile(this.spec.nodes,this),this.marks=pe.compile(this.spec.marks,this);let n=Object.create(null);for(let r in this.nodes){if(r in this.marks)throw new RangeError(r+" can not be both a node and a mark");let i=this.nodes[r],l=i.spec.content||"",o=i.spec.marks;if(i.contentMatch=n[l]||(n[l]=L.parse(l,this.nodes)),i.inlineContent=i.contentMatch.inlineContent,i.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!i.isInline||!i.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=i}i.markSet=o=="_"?null:o?$e(this,o.split(" ")):o==""||!i.inlineContent?[]:null}for(let r in this.marks){let i=this.marks[r],l=i.spec.excludes;i.excluded=l==null?[i]:l==""?[]:$e(this,l.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,t=null,n,r){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof fe){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(t,n,r)}text(e,t){let n=this.nodes.text;return new he(n,n.defaultAttrs,e,k.setFrom(t))}mark(e,t){return typeof e=="string"&&(e=this.marks[e]),e.create(t)}nodeFromJSON(e){return z.fromJSON(this,e)}markFromJSON(e){return k.fromJSON(this,e)}nodeType(e){let t=this.nodes[e];if(!t)throw new RangeError("Unknown node type: "+e);return t}}function $e(s,e){let t=[];for(let n=0;n<e.length;n++){let r=e[n],i=s.marks[r],l=i;if(i)t.push(i);else for(let o in s.marks){let a=s.marks[o];(r=="_"||a.spec.group&&a.spec.group.split(" ").indexOf(r)>-1)&&t.push(l=a)}if(!l)throw new SyntaxError("Unknown mark type: '"+e[n]+"'")}return t}function an(s){return s.tag!=null}function hn(s){return s.style!=null}class ce{constructor(e,t){this.schema=e,this.rules=t,this.tags=[],this.styles=[];let n=this.matchedStyles=[];t.forEach(r=>{if(an(r))this.tags.push(r);else if(hn(r)){let i=/[^=]*/.exec(r.style)[0];n.indexOf(i)<0&&n.push(i),this.styles.push(r)}}),this.normalizeLists=!this.tags.some(r=>{if(!/^(ul|ol)\b/.test(r.tag)||!r.node)return!1;let i=e.nodes[r.node];return i.contentMatch.matchType(i)})}parse(e,t={}){let n=new je(this,t,!1);return n.addAll(e,k.none,t.from,t.to),n.finish()}parseSlice(e,t={}){let n=new je(this,t,!0);return n.addAll(e,k.none,t.from,t.to),y.maxOpen(n.finish())}matchTag(e,t,n){for(let r=n?this.tags.indexOf(n)+1:0;r<this.tags.length;r++){let i=this.tags[r];if(un(e,i.tag)&&(i.namespace===void 0||e.namespaceURI==i.namespace)&&(!i.context||t.matchesContext(i.context))){if(i.getAttrs){let l=i.getAttrs(e);if(l===!1)continue;i.attrs=l||void 0}return i}}}matchStyle(e,t,n,r){for(let i=r?this.styles.indexOf(r)+1:0;i<this.styles.length;i++){let l=this.styles[i],o=l.style;if(!(o.indexOf(e)!=0||l.context&&!n.matchesContext(l.context)||o.length>e.length&&(o.charCodeAt(e.length)!=61||o.slice(e.length+1)!=t))){if(l.getAttrs){let a=l.getAttrs(t);if(a===!1)continue;l.attrs=a||void 0}return l}}}static schemaRules(e){let t=[];function n(r){let i=r.priority==null?50:r.priority,l=0;for(;l<t.length;l++){let o=t[l];if((o.priority==null?50:o.priority)<i)break}t.splice(l,0,r)}for(let r in e.marks){let i=e.marks[r].spec.parseDOM;i&&i.forEach(l=>{n(l=He(l)),l.mark||l.ignore||l.clearMark||(l.mark=r)})}for(let r in e.nodes){let i=e.nodes[r].spec.parseDOM;i&&i.forEach(l=>{n(l=He(l)),l.node||l.ignore||l.mark||(l.node=r)})}return t}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new ce(e,ce.schemaRules(e)))}}const kt={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},fn={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},St={ol:!0,ul:!0},_=1,Oe=2,re=4;function Ue(s,e,t){return e!=null?(e?_:0)|(e==="full"?Oe:0):s&&s.whitespace=="pre"?_|Oe:t&-5}class ne{constructor(e,t,n,r,i,l){this.type=e,this.attrs=t,this.marks=n,this.solid=r,this.options=l,this.content=[],this.activeMarks=k.none,this.match=i||(l&re?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let t=this.type.contentMatch.fillBefore(m.from(e));if(t)this.match=this.type.contentMatch.matchFragment(t);else{let n=this.type.contentMatch,r;return(r=n.findWrapping(e.type))?(this.match=n,r):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&_)){let n=this.content[this.content.length-1],r;if(n&&n.isText&&(r=/[ \t\r\n\u000c]+$/.exec(n.text))){let i=n;n.text.length==r[0].length?this.content.pop():this.content[this.content.length-1]=i.withText(i.text.slice(0,i.text.length-r[0].length))}}let t=m.from(this.content);return!e&&this.match&&(t=t.append(this.match.fillBefore(m.empty,!0))),this.type?this.type.create(this.attrs,t,this.marks):t}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!kt.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class je{constructor(e,t,n){this.parser=e,this.options=t,this.isOpen=n,this.open=0,this.localPreserveWS=!1;let r=t.topNode,i,l=Ue(null,t.preserveWhitespace,0)|(n?re:0);r?i=new ne(r.type,r.attrs,k.none,!0,t.topMatch||r.type.contentMatch,l):n?i=new ne(null,null,k.none,!0,null,l):i=new ne(e.schema.topNodeType,null,k.none,!0,null,l),this.nodes=[i],this.find=t.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,t){e.nodeType==3?this.addTextNode(e,t):e.nodeType==1&&this.addElement(e,t)}addTextNode(e,t){let n=e.nodeValue,r=this.top,i=r.options&Oe?"full":this.localPreserveWS||(r.options&_)>0;if(i==="full"||r.inlineContext(e)||/[^ \t\r\n\u000c]/.test(n)){if(i)i!=="full"?n=n.replace(/\r?\n|\r/g," "):n=n.replace(/\r\n?/g,`
`);else if(n=n.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(n)&&this.open==this.nodes.length-1){let l=r.content[r.content.length-1],o=e.previousSibling;(!l||o&&o.nodeName=="BR"||l.isText&&/[ \t\r\n\u000c]$/.test(l.text))&&(n=n.slice(1))}n&&this.insertNode(this.parser.schema.text(n),t,!/\S/.test(n)),this.findInText(e)}else this.findInside(e)}addElement(e,t,n){let r=this.localPreserveWS,i=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let l=e.nodeName.toLowerCase(),o;St.hasOwnProperty(l)&&this.parser.normalizeLists&&cn(e);let a=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(o=this.parser.matchTag(e,this,n));e:if(a?a.ignore:fn.hasOwnProperty(l))this.findInside(e),this.ignoreFallback(e,t);else if(!a||a.skip||a.closeParent){a&&a.closeParent?this.open=Math.max(0,this.open-1):a&&a.skip.nodeType&&(e=a.skip);let h,f=this.needsBlock;if(kt.hasOwnProperty(l))i.content.length&&i.content[0].isInline&&this.open&&(this.open--,i=this.top),h=!0,i.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,t);break e}let c=a&&a.skip?t:this.readStyles(e,t);c&&this.addAll(e,c),h&&this.sync(i),this.needsBlock=f}else{let h=this.readStyles(e,t);h&&this.addElementByRule(e,a,h,a.consuming===!1?o:void 0)}this.localPreserveWS=r}leafFallback(e,t){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),t)}ignoreFallback(e,t){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),t,!0)}readStyles(e,t){let n=e.style;if(n&&n.length)for(let r=0;r<this.parser.matchedStyles.length;r++){let i=this.parser.matchedStyles[r],l=n.getPropertyValue(i);if(l)for(let o=void 0;;){let a=this.parser.matchStyle(i,l,this,o);if(!a)break;if(a.ignore)return null;if(a.clearMark?t=t.filter(h=>!a.clearMark(h)):t=t.concat(this.parser.schema.marks[a.mark].create(a.attrs)),a.consuming===!1)o=a;else break}}return t}addElementByRule(e,t,n,r){let i,l;if(t.node)if(l=this.parser.schema.nodes[t.node],l.isLeaf)this.insertNode(l.create(t.attrs),n,e.nodeName=="BR")||this.leafFallback(e,n);else{let a=this.enter(l,t.attrs||null,n,t.preserveWhitespace);a&&(i=!0,n=a)}else{let a=this.parser.schema.marks[t.mark];n=n.concat(a.create(t.attrs))}let o=this.top;if(l&&l.isLeaf)this.findInside(e);else if(r)this.addElement(e,n,r);else if(t.getContent)this.findInside(e),t.getContent(e,this.parser.schema).forEach(a=>this.insertNode(a,n,!1));else{let a=e;typeof t.contentElement=="string"?a=e.querySelector(t.contentElement):typeof t.contentElement=="function"?a=t.contentElement(e):t.contentElement&&(a=t.contentElement),this.findAround(e,a,!0),this.addAll(a,n),this.findAround(e,a,!1)}i&&this.sync(o)&&this.open--}addAll(e,t,n,r){let i=n||0;for(let l=n?e.childNodes[n]:e.firstChild,o=r==null?null:e.childNodes[r];l!=o;l=l.nextSibling,++i)this.findAtPoint(e,i),this.addDOM(l,t);this.findAtPoint(e,i)}findPlace(e,t,n){let r,i;for(let l=this.open,o=0;l>=0;l--){let a=this.nodes[l],h=a.findWrapping(e);if(h&&(!r||r.length>h.length+o)&&(r=h,i=a,!h.length))break;if(a.solid){if(n)break;o+=2}}if(!r)return null;this.sync(i);for(let l=0;l<r.length;l++)t=this.enterInner(r[l],null,t,!1);return t}insertNode(e,t,n){if(e.isInline&&this.needsBlock&&!this.top.type){let i=this.textblockFromContext();i&&(t=this.enterInner(i,null,t))}let r=this.findPlace(e,t,n);if(r){this.closeExtra();let i=this.top;i.match&&(i.match=i.match.matchType(e.type));let l=k.none;for(let o of r.concat(e.marks))(i.type?i.type.allowsMarkType(o.type):Ge(o.type,e.type))&&(l=o.addToSet(l));return i.content.push(e.mark(l)),!0}return!1}enter(e,t,n,r){let i=this.findPlace(e.create(t),n,!1);return i&&(i=this.enterInner(e,t,n,!0,r)),i}enterInner(e,t,n,r=!1,i){this.closeExtra();let l=this.top;l.match=l.match&&l.match.matchType(e);let o=Ue(e,i,l.options);l.options&re&&l.content.length==0&&(o|=re);let a=k.none;return n=n.filter(h=>(l.type?l.type.allowsMarkType(h.type):Ge(h.type,e))?(a=h.addToSet(a),!1):!0),this.nodes.push(new ne(e,t,a,r,null,o)),this.open++,n}closeExtra(e=!1){let t=this.nodes.length-1;if(t>this.open){for(;t>this.open;t--)this.nodes[t-1].content.push(this.nodes[t].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let t=this.open;t>=0;t--){if(this.nodes[t]==e)return this.open=t,!0;this.localPreserveWS&&(this.nodes[t].options|=_)}return!1}get currentPos(){this.closeExtra();let e=0;for(let t=this.open;t>=0;t--){let n=this.nodes[t].content;for(let r=n.length-1;r>=0;r--)e+=n[r].nodeSize;t&&e++}return e}findAtPoint(e,t){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&this.find[n].offset==t&&(this.find[n].pos=this.currentPos)}findInside(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].pos==null&&e.nodeType==1&&e.contains(this.find[t].node)&&(this.find[t].pos=this.currentPos)}findAround(e,t,n){if(e!=t&&this.find)for(let r=0;r<this.find.length;r++)this.find[r].pos==null&&e.nodeType==1&&e.contains(this.find[r].node)&&t.compareDocumentPosition(this.find[r].node)&(n?2:4)&&(this.find[r].pos=this.currentPos)}findInText(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].node==e&&(this.find[t].pos=this.currentPos-(e.nodeValue.length-this.find[t].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let t=e.split("/"),n=this.options.context,r=!this.isOpen&&(!n||n.parent.type==this.nodes[0].type),i=-(n?n.depth+1:0)+(r?0:1),l=(o,a)=>{for(;o>=0;o--){let h=t[o];if(h==""){if(o==t.length-1||o==0)continue;for(;a>=i;a--)if(l(o-1,a))return!0;return!1}else{let f=a>0||a==0&&r?this.nodes[a].type:n&&a>=i?n.node(a-i).type:null;if(!f||f.name!=h&&!f.isInGroup(h))return!1;a--}}return!0};return l(t.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let t=e.depth;t>=0;t--){let n=e.node(t).contentMatchAt(e.indexAfter(t)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(let t in this.parser.schema.nodes){let n=this.parser.schema.nodes[t];if(n.isTextblock&&n.defaultAttrs)return n}}}function cn(s){for(let e=s.firstChild,t=null;e;e=e.nextSibling){let n=e.nodeType==1?e.nodeName.toLowerCase():null;n&&St.hasOwnProperty(n)&&t?(t.appendChild(e),e=t):n=="li"?t=e:n&&(t=null)}}function un(s,e){return(s.matches||s.msMatchesSelector||s.webkitMatchesSelector||s.mozMatchesSelector).call(s,e)}function He(s){let e={};for(let t in s)e[t]=s[t];return e}function Ge(s,e){let t=e.schema.nodes;for(let n in t){let r=t[n];if(!r.allowsMarkType(s))continue;let i=[],l=o=>{i.push(o);for(let a=0;a<o.edgeCount;a++){let{type:h,next:f}=o.edge(a);if(h==e||i.indexOf(f)<0&&l(f))return!0}};if(l(r.contentMatch))return!0}}class Re{constructor(e,t){this.nodes=e,this.marks=t}serializeFragment(e,t={},n){n||(n=we(t).createDocumentFragment());let r=n,i=[];return e.forEach(l=>{if(i.length||l.marks.length){let o=0,a=0;for(;o<i.length&&a<l.marks.length;){let h=l.marks[a];if(!this.marks[h.type.name]){a++;continue}if(!h.eq(i[o][0])||h.type.spec.spanning===!1)break;o++,a++}for(;o<i.length;)r=i.pop()[1];for(;a<l.marks.length;){let h=l.marks[a++],f=this.serializeMark(h,l.isInline,t);f&&(i.push([h,r]),r.appendChild(f.dom),r=f.contentDOM||f.dom)}}r.appendChild(this.serializeNodeInner(l,t))}),n}serializeNodeInner(e,t){let{dom:n,contentDOM:r}=ie(we(t),this.nodes[e.type.name](e),null,e.attrs);if(r){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,t,r)}return n}serializeNode(e,t={}){let n=this.serializeNodeInner(e,t);for(let r=e.marks.length-1;r>=0;r--){let i=this.serializeMark(e.marks[r],e.isInline,t);i&&((i.contentDOM||i.dom).appendChild(n),n=i.dom)}return n}serializeMark(e,t,n={}){let r=this.marks[e.type.name];return r&&ie(we(n),r(e,t),null,e.attrs)}static renderSpec(e,t,n=null,r){return ie(e,t,n,r)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new Re(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let t=Ke(e.nodes);return t.text||(t.text=n=>n.text),t}static marksFromSchema(e){return Ke(e.marks)}}function Ke(s){let e={};for(let t in s){let n=s[t].spec.toDOM;n&&(e[t]=n)}return e}function we(s){return s.document||window.document}const Qe=new WeakMap;function pn(s){let e=Qe.get(s);return e===void 0&&Qe.set(s,e=dn(s)),e}function dn(s){let e=null;function t(n){if(n&&typeof n=="object")if(Array.isArray(n))if(typeof n[0]=="string")e||(e=[]),e.push(n);else for(let r=0;r<n.length;r++)t(n[r]);else for(let r in n)t(n[r])}return t(s),e}function ie(s,e,t,n){if(typeof e=="string")return{dom:s.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let r=e[0],i;if(typeof r!="string")throw new RangeError("Invalid array passed to renderSpec");if(n&&(i=pn(n))&&i.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let l=r.indexOf(" ");l>0&&(t=r.slice(0,l),r=r.slice(l+1));let o,a=t?s.createElementNS(t,r):s.createElement(r),h=e[1],f=1;if(h&&typeof h=="object"&&h.nodeType==null&&!Array.isArray(h)){f=2;for(let c in h)if(h[c]!=null){let p=c.indexOf(" ");p>0?a.setAttributeNS(c.slice(0,p),c.slice(p+1),h[c]):a.setAttribute(c,h[c])}}for(let c=f;c<e.length;c++){let p=e[c];if(p===0){if(c<e.length-1||c>f)throw new RangeError("Content hole must be the only child of its parent node");return{dom:a,contentDOM:a}}else{let{dom:u,contentDOM:d}=ie(s,p,t,n);if(a.appendChild(u),d){if(o)throw new RangeError("Multiple content holes");o=d}}}return{dom:a,contentDOM:o}}function hr(s){const t=Re.fromSchema(s.schema).serializeFragment(s.doc.content),n=document.createElement("div");return n.append(t),n.innerHTML}function fr(s,e){const t=document.implementation.createHTMLDocument();return t.body.innerHTML=e,ce.fromSchema(s).parse(t.body)}function cr(s){return function(e){const{from:t,$from:n,to:r,empty:i}=e.selection;return s?i?s.isInSet(e.storedMarks||n.marks()):e.doc.rangeHasMark(t,r,s):!1}}function ur(s,e){const t=s.selection.$from;for(let n=t.depth;n>=0;n--){const r=t.index(n);if(t.node(n).canReplaceWith(r,r,e))return!0}return!1}function pr(s,e,t){for(let n=0;n<e.length;n++){const{$from:r,$to:i}=e[n];let l=r.depth===0?s.type.allowsMarkType(t):!1;if(s.nodesBetween(r.pos,i.pos,o=>{if(l)return!1;l=o.inlineContent&&o.type.allowsMarkType(t)}),l)return!0}return!1}function dr(s,e){return function(t){const n=Object.assign({},e),{$from:r,to:i,node:l}=t.selection;return l?(l.attrs.id&&(n.id=l.attrs.id),l.hasMarkup(s,n)):(r.parent&&r.parent.attrs.id&&(n.id=r.parent.attrs.id),i<=r.end()&&r.parent.hasMarkup(s,n))}}const vt=65535,bt=Math.pow(2,16);function mn(s,e){return s+e*bt}function Xe(s){return s&vt}function gn(s){return(s-(s&vt))/bt}const Mt=1,Ct=2,se=4,Et=8;class Ie{constructor(e,t,n){this.pos=e,this.delInfo=t,this.recover=n}get deleted(){return(this.delInfo&Et)>0}get deletedBefore(){return(this.delInfo&(Mt|se))>0}get deletedAfter(){return(this.delInfo&(Ct|se))>0}get deletedAcross(){return(this.delInfo&se)>0}}class O{constructor(e,t=!1){if(this.ranges=e,this.inverted=t,!e.length&&O.empty)return O.empty}recover(e){let t=0,n=Xe(e);if(!this.inverted)for(let r=0;r<n;r++)t+=this.ranges[r*3+2]-this.ranges[r*3+1];return this.ranges[n*3]+t+gn(e)}mapResult(e,t=1){return this._map(e,t,!1)}map(e,t=1){return this._map(e,t,!0)}_map(e,t,n){let r=0,i=this.inverted?2:1,l=this.inverted?1:2;for(let o=0;o<this.ranges.length;o+=3){let a=this.ranges[o]-(this.inverted?r:0);if(a>e)break;let h=this.ranges[o+i],f=this.ranges[o+l],c=a+h;if(e<=c){let p=h?e==a?-1:e==c?1:t:t,u=a+r+(p<0?0:f);if(n)return u;let d=e==(t<0?a:c)?null:mn(o/3,e-a),g=e==a?Ct:e==c?Mt:se;return(t<0?e!=a:e!=c)&&(g|=Et),new Ie(u,g,d)}r+=f-h}return n?e+r:new Ie(e+r,0,null)}touches(e,t){let n=0,r=Xe(t),i=this.inverted?2:1,l=this.inverted?1:2;for(let o=0;o<this.ranges.length;o+=3){let a=this.ranges[o]-(this.inverted?n:0);if(a>e)break;let h=this.ranges[o+i],f=a+h;if(e<=f&&o==r*3)return!0;n+=this.ranges[o+l]-h}return!1}forEach(e){let t=this.inverted?2:1,n=this.inverted?1:2;for(let r=0,i=0;r<this.ranges.length;r+=3){let l=this.ranges[r],o=l-(this.inverted?i:0),a=l+(this.inverted?0:i),h=this.ranges[r+t],f=this.ranges[r+n];e(o,o+h,a,a+f),i+=f-h}}invert(){return new O(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?O.empty:new O(e<0?[0,-e,0]:[0,0,e])}}O.empty=new O([]);class ue{constructor(e,t,n=0,r=e?e.length:0){this.mirror=t,this.from=n,this.to=r,this._maps=e||[],this.ownData=!(e||t)}get maps(){return this._maps}slice(e=0,t=this.maps.length){return new ue(this._maps,this.mirror,e,t)}appendMap(e,t){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),t!=null&&this.setMirror(this._maps.length-1,t)}appendMapping(e){for(let t=0,n=this._maps.length;t<e._maps.length;t++){let r=e.getMirror(t);this.appendMap(e._maps[t],r!=null&&r<t?n+r:void 0)}}getMirror(e){if(this.mirror){for(let t=0;t<this.mirror.length;t++)if(this.mirror[t]==e)return this.mirror[t+(t%2?-1:1)]}}setMirror(e,t){this.mirror||(this.mirror=[]),this.mirror.push(e,t)}appendMappingInverted(e){for(let t=e.maps.length-1,n=this._maps.length+e._maps.length;t>=0;t--){let r=e.getMirror(t);this.appendMap(e._maps[t].invert(),r!=null&&r>t?n-r-1:void 0)}}invert(){let e=new ue;return e.appendMappingInverted(this),e}map(e,t=1){if(this.mirror)return this._map(e,t,!0);for(let n=this.from;n<this.to;n++)e=this._maps[n].map(e,t);return e}mapResult(e,t=1){return this._map(e,t,!1)}_map(e,t,n){let r=0;for(let i=this.from;i<this.to;i++){let l=this._maps[i],o=l.mapResult(e,t);if(o.recover!=null){let a=this.getMirror(i);if(a!=null&&a>i&&a<this.to){i=a,e=this._maps[a].recover(o.recover);continue}}r|=o.delInfo,e=o.pos}return n?e:new Ie(e,r,null)}}const xe=Object.create(null);class E{getMap(){return O.empty}merge(e){return null}static fromJSON(e,t){if(!t||!t.stepType)throw new RangeError("Invalid input for Step.fromJSON");let n=xe[t.stepType];if(!n)throw new RangeError(`No step type ${t.stepType} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in xe)throw new RangeError("Duplicate use of step JSON ID "+e);return xe[e]=t,t.prototype.jsonID=e,t}}class b{constructor(e,t){this.doc=e,this.failed=t}static ok(e){return new b(e,null)}static fail(e){return new b(null,e)}static fromReplace(e,t,n,r){try{return b.ok(e.replace(t,n,r))}catch(i){if(i instanceof oe)return b.fail(i.message);throw i}}}function ze(s,e,t){let n=[];for(let r=0;r<s.childCount;r++){let i=s.child(r);i.content.size&&(i=i.copy(ze(i.content,e,i))),i.isInline&&(i=e(i,t,r)),n.push(i)}return m.fromArray(n)}class J extends E{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=e.resolve(this.from),r=n.node(n.sharedDepth(this.to)),i=new y(ze(t.content,(l,o)=>!l.isAtom||!o.type.allowsMarkType(this.mark.type)?l:l.mark(this.mark.addToSet(l.marks)),r),t.openStart,t.openEnd);return b.fromReplace(e,this.from,this.to,i)}invert(){return new R(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new J(t.pos,n.pos,this.mark)}merge(e){return e instanceof J&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new J(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new J(t.from,t.to,e.markFromJSON(t.mark))}}E.jsonID("addMark",J);class R extends E{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=new y(ze(t.content,r=>r.mark(this.mark.removeFromSet(r.marks)),e),t.openStart,t.openEnd);return b.fromReplace(e,this.from,this.to,n)}invert(){return new J(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new R(t.pos,n.pos,this.mark)}merge(e){return e instanceof R&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new R(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new R(t.from,t.to,e.markFromJSON(t.mark))}}E.jsonID("removeMark",R);class D extends E{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return b.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.addToSet(t.marks));return b.fromReplace(e,this.pos,this.pos+1,new y(m.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);if(t){let n=this.mark.addToSet(t.marks);if(n.length==t.marks.length){for(let r=0;r<t.marks.length;r++)if(!t.marks[r].isInSet(n))return new D(this.pos,t.marks[r]);return new D(this.pos,this.mark)}}return new q(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new D(t.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new D(t.pos,e.markFromJSON(t.mark))}}E.jsonID("addNodeMark",D);class q extends E{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return b.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.removeFromSet(t.marks));return b.fromReplace(e,this.pos,this.pos+1,new y(m.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);return!t||!this.mark.isInSet(t.marks)?this:new D(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new q(t.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new q(t.pos,e.markFromJSON(t.mark))}}E.jsonID("removeNodeMark",q);class C extends E{constructor(e,t,n,r=!1){super(),this.from=e,this.to=t,this.slice=n,this.structure=r}apply(e){return this.structure&&Ne(e,this.from,this.to)?b.fail("Structure replace would overwrite content"):b.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new O([this.from,this.to-this.from,this.slice.size])}invert(e){return new C(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deletedAcross&&n.deletedAcross?null:new C(t.pos,Math.max(t.pos,n.pos),this.slice,this.structure)}merge(e){if(!(e instanceof C)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let t=this.slice.size+e.slice.size==0?y.empty:new y(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new C(this.from,this.to+(e.to-e.from),t,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let t=this.slice.size+e.slice.size==0?y.empty:new y(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new C(e.from,this.to,t,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new C(t.from,t.to,y.fromJSON(e,t.slice),!!t.structure)}}E.jsonID("replace",C);class T extends E{constructor(e,t,n,r,i,l,o=!1){super(),this.from=e,this.to=t,this.gapFrom=n,this.gapTo=r,this.slice=i,this.insert=l,this.structure=o}apply(e){if(this.structure&&(Ne(e,this.from,this.gapFrom)||Ne(e,this.gapTo,this.to)))return b.fail("Structure gap-replace would overwrite content");let t=e.slice(this.gapFrom,this.gapTo);if(t.openStart||t.openEnd)return b.fail("Gap is not a flat range");let n=this.slice.insertAt(this.insert,t.content);return n?b.fromReplace(e,this.from,this.to,n):b.fail("Content does not fit in gap")}getMap(){return new O([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let t=this.gapTo-this.gapFrom;return new T(this.from,this.from+this.slice.size+t,this.from+this.insert,this.from+this.insert+t,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1),r=this.from==this.gapFrom?t.pos:e.map(this.gapFrom,-1),i=this.to==this.gapTo?n.pos:e.map(this.gapTo,1);return t.deletedAcross&&n.deletedAcross||r<t.pos||i>n.pos?null:new T(t.pos,n.pos,r,i,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number"||typeof t.gapFrom!="number"||typeof t.gapTo!="number"||typeof t.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new T(t.from,t.to,t.gapFrom,t.gapTo,y.fromJSON(e,t.slice),t.insert,!!t.structure)}}E.jsonID("replaceAround",T);function Ne(s,e,t){let n=s.resolve(e),r=t-e,i=n.depth;for(;r>0&&i>0&&n.indexAfter(i)==n.node(i).childCount;)i--,r--;if(r>0){let l=n.node(i).maybeChild(n.indexAfter(i));for(;r>0;){if(!l||l.isLeaf)return!0;l=l.firstChild,r--}}return!1}function yn(s,e,t,n){let r=[],i=[],l,o;s.doc.nodesBetween(e,t,(a,h,f)=>{if(!a.isInline)return;let c=a.marks;if(!n.isInSet(c)&&f.type.allowsMarkType(n.type)){let p=Math.max(h,e),u=Math.min(h+a.nodeSize,t),d=n.addToSet(c);for(let g=0;g<c.length;g++)c[g].isInSet(d)||(l&&l.to==p&&l.mark.eq(c[g])?l.to=u:r.push(l=new R(p,u,c[g])));o&&o.to==p?o.to=u:i.push(o=new J(p,u,n))}}),r.forEach(a=>s.step(a)),i.forEach(a=>s.step(a))}function wn(s,e,t,n){let r=[],i=0;s.doc.nodesBetween(e,t,(l,o)=>{if(!l.isInline)return;i++;let a=null;if(n instanceof pe){let h=l.marks,f;for(;f=n.isInSet(h);)(a||(a=[])).push(f),h=f.removeFromSet(h)}else n?n.isInSet(l.marks)&&(a=[n]):a=l.marks;if(a&&a.length){let h=Math.min(o+l.nodeSize,t);for(let f=0;f<a.length;f++){let c=a[f],p;for(let u=0;u<r.length;u++){let d=r[u];d.step==i-1&&c.eq(r[u].style)&&(p=d)}p?(p.to=h,p.step=i):r.push({style:c,from:Math.max(o,e),to:h,step:i})}}}),r.forEach(l=>s.step(new R(l.from,l.to,l.style)))}function Be(s,e,t,n=t.contentMatch,r=!0){let i=s.doc.nodeAt(e),l=[],o=e+1;for(let a=0;a<i.childCount;a++){let h=i.child(a),f=o+h.nodeSize,c=n.matchType(h.type);if(!c)l.push(new C(o,f,y.empty));else{n=c;for(let p=0;p<h.marks.length;p++)t.allowsMarkType(h.marks[p].type)||s.step(new R(o,f,h.marks[p]));if(r&&h.isText&&t.whitespace!="pre"){let p,u=/\r?\n|\r/g,d;for(;p=u.exec(h.text);)d||(d=new y(m.from(t.schema.text(" ",t.allowedMarks(h.marks))),0,0)),l.push(new C(o+p.index,o+p.index+p[0].length,d))}}o=f}if(!n.validEnd){let a=n.fillBefore(m.empty,!0);s.replace(o,o,new y(a,0,0))}for(let a=l.length-1;a>=0;a--)s.step(l[a])}function xn(s,e,t){return(e==0||s.canReplace(e,s.childCount))&&(t==s.childCount||s.canReplace(0,t))}function de(s){let t=s.parent.content.cutByIndex(s.startIndex,s.endIndex);for(let n=s.depth;;--n){let r=s.$from.node(n),i=s.$from.index(n),l=s.$to.indexAfter(n);if(n<s.depth&&r.canReplace(i,l,t))return n;if(n==0||r.type.spec.isolating||!xn(r,i,l))break}return null}function kn(s,e,t){let{$from:n,$to:r,depth:i}=e,l=n.before(i+1),o=r.after(i+1),a=l,h=o,f=m.empty,c=0;for(let d=i,g=!1;d>t;d--)g||n.index(d)>0?(g=!0,f=m.from(n.node(d).copy(f)),c++):a--;let p=m.empty,u=0;for(let d=i,g=!1;d>t;d--)g||r.after(d+1)<r.end(d)?(g=!0,p=m.from(r.node(d).copy(p)),u++):h++;s.step(new T(a,h,l,o,new y(f.append(p),c,u),f.size-c,!0))}function Tt(s,e,t=null,n=s){let r=Sn(s,e),i=r&&vn(n,e);return i?r.map(Ye).concat({type:e,attrs:t}).concat(i.map(Ye)):null}function Ye(s){return{type:s,attrs:null}}function Sn(s,e){let{parent:t,startIndex:n,endIndex:r}=s,i=t.contentMatchAt(n).findWrapping(e);if(!i)return null;let l=i.length?i[0]:e;return t.canReplaceWith(n,r,l)?i:null}function vn(s,e){let{parent:t,startIndex:n,endIndex:r}=s,i=t.child(n),l=e.contentMatch.findWrapping(i.type);if(!l)return null;let a=(l.length?l[l.length-1]:e).contentMatch;for(let h=n;a&&h<r;h++)a=a.matchType(t.child(h).type);return!a||!a.validEnd?null:l}function bn(s,e,t){let n=m.empty;for(let l=t.length-1;l>=0;l--){if(n.size){let o=t[l].type.contentMatch.matchFragment(n);if(!o||!o.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}n=m.from(t[l].type.create(t[l].attrs,n))}let r=e.start,i=e.end;s.step(new T(r,i,r,i,new y(n,0,0),t.length,!0))}function Mn(s,e,t,n,r){if(!n.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let i=s.steps.length;s.doc.nodesBetween(e,t,(l,o)=>{let a=typeof r=="function"?r(l):r;if(l.isTextblock&&!l.hasMarkup(n,a)&&Cn(s.doc,s.mapping.slice(i).map(o),n)){let h=null;if(n.schema.linebreakReplacement){let u=n.whitespace=="pre",d=!!n.contentMatch.matchType(n.schema.linebreakReplacement);u&&!d?h=!1:!u&&d&&(h=!0)}h===!1&&It(s,l,o,i),Be(s,s.mapping.slice(i).map(o,1),n,void 0,h===null);let f=s.mapping.slice(i),c=f.map(o,1),p=f.map(o+l.nodeSize,1);return s.step(new T(c,p,c+1,p-1,new y(m.from(n.create(a,null,l.marks)),0,0),1,!0)),h===!0&&Ot(s,l,o,i),!1}})}function Ot(s,e,t,n){e.forEach((r,i)=>{if(r.isText){let l,o=/\r?\n|\r/g;for(;l=o.exec(r.text);){let a=s.mapping.slice(n).map(t+1+i+l.index);s.replaceWith(a,a+1,e.type.schema.linebreakReplacement.create())}}})}function It(s,e,t,n){e.forEach((r,i)=>{if(r.type==r.type.schema.linebreakReplacement){let l=s.mapping.slice(n).map(t+1+i);s.replaceWith(l,l+1,e.type.schema.text(`
`))}})}function Cn(s,e,t){let n=s.resolve(e),r=n.index();return n.parent.canReplaceWith(r,r+1,t)}function En(s,e,t,n,r){let i=s.doc.nodeAt(e);if(!i)throw new RangeError("No node at given position");t||(t=i.type);let l=t.create(n,null,r||i.marks);if(i.isLeaf)return s.replaceWith(e,e+i.nodeSize,l);if(!t.validContent(i.content))throw new RangeError("Invalid content for node type "+t.name);s.step(new T(e,e+i.nodeSize,e+1,e+i.nodeSize-1,new y(m.from(l),0,0),1,!0))}function $(s,e,t=1,n){let r=s.resolve(e),i=r.depth-t,l=n&&n[n.length-1]||r.parent;if(i<0||r.parent.type.spec.isolating||!r.parent.canReplace(r.index(),r.parent.childCount)||!l.type.validContent(r.parent.content.cutByIndex(r.index(),r.parent.childCount)))return!1;for(let h=r.depth-1,f=t-2;h>i;h--,f--){let c=r.node(h),p=r.index(h);if(c.type.spec.isolating)return!1;let u=c.content.cutByIndex(p,c.childCount),d=n&&n[f+1];d&&(u=u.replaceChild(0,d.type.create(d.attrs)));let g=n&&n[f]||c;if(!c.canReplace(p+1,c.childCount)||!g.type.validContent(u))return!1}let o=r.indexAfter(i),a=n&&n[0];return r.node(i).canReplaceWith(o,o,a?a.type:r.node(i+1).type)}function Tn(s,e,t=1,n){let r=s.doc.resolve(e),i=m.empty,l=m.empty;for(let o=r.depth,a=r.depth-t,h=t-1;o>a;o--,h--){i=m.from(r.node(o).copy(i));let f=n&&n[h];l=m.from(f?f.type.create(f.attrs,l):r.node(o).copy(l))}s.step(new C(e,e,new y(i.append(l),t,t),!0))}function me(s,e){let t=s.resolve(e),n=t.index();return Nt(t.nodeBefore,t.nodeAfter)&&t.parent.canReplace(n,n+1)}function On(s,e){e.content.size||s.type.compatibleContent(e.type);let t=s.contentMatchAt(s.childCount),{linebreakReplacement:n}=s.type.schema;for(let r=0;r<e.childCount;r++){let i=e.child(r),l=i.type==n?s.type.schema.nodes.text:i.type;if(t=t.matchType(l),!t||!s.type.allowsMarks(i.marks))return!1}return t.validEnd}function Nt(s,e){return!!(s&&e&&!s.isLeaf&&On(s,e))}function At(s,e,t=-1){let n=s.resolve(e);for(let r=n.depth;;r--){let i,l,o=n.index(r);if(r==n.depth?(i=n.nodeBefore,l=n.nodeAfter):t>0?(i=n.node(r+1),o++,l=n.node(r).maybeChild(o)):(i=n.node(r).maybeChild(o-1),l=n.node(r+1)),i&&!i.isTextblock&&Nt(i,l)&&n.node(r).canReplace(o,o+1))return e;if(r==0)break;e=t<0?n.before(r):n.after(r)}}function In(s,e,t){let n=null,{linebreakReplacement:r}=s.doc.type.schema,i=s.doc.resolve(e-t),l=i.node().type;if(r&&l.inlineContent){let f=l.whitespace=="pre",c=!!l.contentMatch.matchType(r);f&&!c?n=!1:!f&&c&&(n=!0)}let o=s.steps.length;if(n===!1){let f=s.doc.resolve(e+t);It(s,f.node(),f.before(),o)}l.inlineContent&&Be(s,e+t-1,l,i.node().contentMatchAt(i.index()),n==null);let a=s.mapping.slice(o),h=a.map(e-t);if(s.step(new C(h,a.map(e+t,-1),y.empty,!0)),n===!0){let f=s.doc.resolve(h);Ot(s,f.node(),f.before(),s.steps.length)}return s}function Nn(s,e,t){let n=s.resolve(e);if(n.parent.canReplaceWith(n.index(),n.index(),t))return e;if(n.parentOffset==0)for(let r=n.depth-1;r>=0;r--){let i=n.index(r);if(n.node(r).canReplaceWith(i,i,t))return n.before(r+1);if(i>0)return null}if(n.parentOffset==n.parent.content.size)for(let r=n.depth-1;r>=0;r--){let i=n.indexAfter(r);if(n.node(r).canReplaceWith(i,i,t))return n.after(r+1);if(i<n.node(r).childCount)return null}return null}function mr(s,e,t){let n=s.resolve(e);if(!t.content.size)return e;let r=t.content;for(let i=0;i<t.openStart;i++)r=r.firstChild.content;for(let i=1;i<=(t.openStart==0&&t.size?2:1);i++)for(let l=n.depth;l>=0;l--){let o=l==n.depth?0:n.pos<=(n.start(l+1)+n.end(l+1))/2?-1:1,a=n.index(l)+(o>0?1:0),h=n.node(l),f=!1;if(i==1)f=h.canReplace(a,a,r);else{let c=h.contentMatchAt(a).findWrapping(r.firstChild.type);f=c&&h.canReplaceWith(a,a,c[0])}if(f)return o==0?n.pos:o<0?n.before(l+1):n.after(l+1)}return null}function Fe(s,e,t=e,n=y.empty){if(e==t&&!n.size)return null;let r=s.resolve(e),i=s.resolve(t);return Rt(r,i,n)?new C(e,t,n):new An(r,i,n).fit()}function Rt(s,e,t){return!t.openStart&&!t.openEnd&&s.start()==e.start()&&s.parent.canReplace(s.index(),e.index(),t.content)}class An{constructor(e,t,n){this.$from=e,this.$to=t,this.unplaced=n,this.frontier=[],this.placed=m.empty;for(let r=0;r<=e.depth;r++){let i=e.node(r);this.frontier.push({type:i.type,match:i.contentMatchAt(e.indexAfter(r))})}for(let r=e.depth;r>0;r--)this.placed=m.from(e.node(r).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let h=this.findFittable();h?this.placeNodes(h):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),t=this.placed.size-this.depth-this.$from.depth,n=this.$from,r=this.close(e<0?this.$to:n.doc.resolve(e));if(!r)return null;let i=this.placed,l=n.depth,o=r.depth;for(;l&&o&&i.childCount==1;)i=i.firstChild.content,l--,o--;let a=new y(i,l,o);return e>-1?new T(n.pos,e,this.$to.pos,this.$to.end(),a,t):a.size||n.pos!=this.$to.pos?new C(n.pos,r.pos,a):null}findFittable(){let e=this.unplaced.openStart;for(let t=this.unplaced.content,n=0,r=this.unplaced.openEnd;n<e;n++){let i=t.firstChild;if(t.childCount>1&&(r=0),i.type.spec.isolating&&r<=n){e=n;break}t=i.content}for(let t=1;t<=2;t++)for(let n=t==1?e:this.unplaced.openStart;n>=0;n--){let r,i=null;n?(i=ke(this.unplaced.content,n-1).firstChild,r=i.content):r=this.unplaced.content;let l=r.firstChild;for(let o=this.depth;o>=0;o--){let{type:a,match:h}=this.frontier[o],f,c=null;if(t==1&&(l?h.matchType(l.type)||(c=h.fillBefore(m.from(l),!1)):i&&a.compatibleContent(i.type)))return{sliceDepth:n,frontierDepth:o,parent:i,inject:c};if(t==2&&l&&(f=h.findWrapping(l.type)))return{sliceDepth:n,frontierDepth:o,parent:i,wrap:f};if(i&&h.matchType(i.type))break}}}openMore(){let{content:e,openStart:t,openEnd:n}=this.unplaced,r=ke(e,t);return!r.childCount||r.firstChild.isLeaf?!1:(this.unplaced=new y(e,t+1,Math.max(n,r.size+t>=e.size-n?t+1:0)),!0)}dropNode(){let{content:e,openStart:t,openEnd:n}=this.unplaced,r=ke(e,t);if(r.childCount<=1&&t>0){let i=e.size-t<=t+r.size;this.unplaced=new y(G(e,t-1,1),t-1,i?t-1:n)}else this.unplaced=new y(G(e,t,1),t,n)}placeNodes({sliceDepth:e,frontierDepth:t,parent:n,inject:r,wrap:i}){for(;this.depth>t;)this.closeFrontierNode();if(i)for(let g=0;g<i.length;g++)this.openFrontierNode(i[g]);let l=this.unplaced,o=n?n.content:l.content,a=l.openStart-e,h=0,f=[],{match:c,type:p}=this.frontier[t];if(r){for(let g=0;g<r.childCount;g++)f.push(r.child(g));c=c.matchFragment(r)}let u=o.size+e-(l.content.size-l.openEnd);for(;h<o.childCount;){let g=o.child(h),w=c.matchType(g.type);if(!w)break;h++,(h>1||a==0||g.content.size)&&(c=w,f.push(zt(g.mark(p.allowedMarks(g.marks)),h==1?a:0,h==o.childCount?u:-1)))}let d=h==o.childCount;d||(u=-1),this.placed=K(this.placed,t,m.from(f)),this.frontier[t].match=c,d&&u<0&&n&&n.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let g=0,w=o;g<u;g++){let x=w.lastChild;this.frontier.push({type:x.type,match:x.contentMatchAt(x.childCount)}),w=x.content}this.unplaced=d?e==0?y.empty:new y(G(l.content,e-1,1),e-1,u<0?l.openEnd:e-1):new y(G(l.content,e,h),l.openStart,l.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],t;if(!e.type.isTextblock||!Se(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;let{depth:n}=this.$to,r=this.$to.after(n);for(;n>1&&r==this.$to.end(--n);)++r;return r}findCloseLevel(e){e:for(let t=Math.min(this.depth,e.depth);t>=0;t--){let{match:n,type:r}=this.frontier[t],i=t<e.depth&&e.end(t+1)==e.pos+(e.depth-(t+1)),l=Se(e,t,r,n,i);if(l){for(let o=t-1;o>=0;o--){let{match:a,type:h}=this.frontier[o],f=Se(e,o,h,a,!0);if(!f||f.childCount)continue e}return{depth:t,fit:l,move:i?e.doc.resolve(e.after(t+1)):e}}}}close(e){let t=this.findCloseLevel(e);if(!t)return null;for(;this.depth>t.depth;)this.closeFrontierNode();t.fit.childCount&&(this.placed=K(this.placed,t.depth,t.fit)),e=t.move;for(let n=t.depth+1;n<=e.depth;n++){let r=e.node(n),i=r.type.contentMatch.fillBefore(r.content,!0,e.index(n));this.openFrontierNode(r.type,r.attrs,i)}return e}openFrontierNode(e,t=null,n){let r=this.frontier[this.depth];r.match=r.match.matchType(e),this.placed=K(this.placed,this.depth,m.from(e.create(t,n))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let t=this.frontier.pop().match.fillBefore(m.empty,!0);t.childCount&&(this.placed=K(this.placed,this.frontier.length,t))}}function G(s,e,t){return e==0?s.cutByIndex(t,s.childCount):s.replaceChild(0,s.firstChild.copy(G(s.firstChild.content,e-1,t)))}function K(s,e,t){return e==0?s.append(t):s.replaceChild(s.childCount-1,s.lastChild.copy(K(s.lastChild.content,e-1,t)))}function ke(s,e){for(let t=0;t<e;t++)s=s.firstChild.content;return s}function zt(s,e,t){if(e<=0)return s;let n=s.content;return e>1&&(n=n.replaceChild(0,zt(n.firstChild,e-1,n.childCount==1?t-1:0))),e>0&&(n=s.type.contentMatch.fillBefore(n).append(n),t<=0&&(n=n.append(s.type.contentMatch.matchFragment(n).fillBefore(m.empty,!0)))),s.copy(n)}function Se(s,e,t,n,r){let i=s.node(e),l=r?s.indexAfter(e):s.index(e);if(l==i.childCount&&!t.compatibleContent(i.type))return null;let o=n.fillBefore(i.content,!0,l);return o&&!Rn(t,i.content,l)?o:null}function Rn(s,e,t){for(let n=t;n<e.childCount;n++)if(!s.allowsMarks(e.child(n).marks))return!0;return!1}function zn(s){return s.spec.defining||s.spec.definingForContent}function Bn(s,e,t,n){if(!n.size)return s.deleteRange(e,t);let r=s.doc.resolve(e),i=s.doc.resolve(t);if(Rt(r,i,n))return s.step(new C(e,t,n));let l=Ft(r,s.doc.resolve(t));l[l.length-1]==0&&l.pop();let o=-(r.depth+1);l.unshift(o);for(let p=r.depth,u=r.pos-1;p>0;p--,u--){let d=r.node(p).type.spec;if(d.defining||d.definingAsContext||d.isolating)break;l.indexOf(p)>-1?o=p:r.before(p)==u&&l.splice(1,0,-p)}let a=l.indexOf(o),h=[],f=n.openStart;for(let p=n.content,u=0;;u++){let d=p.firstChild;if(h.push(d),u==n.openStart)break;p=d.content}for(let p=f-1;p>=0;p--){let u=h[p],d=zn(u.type);if(d&&!u.sameMarkup(r.node(Math.abs(o)-1)))f=p;else if(d||!u.type.isTextblock)break}for(let p=n.openStart;p>=0;p--){let u=(p+f+1)%(n.openStart+1),d=h[u];if(d)for(let g=0;g<l.length;g++){let w=l[(g+a)%l.length],x=!0;w<0&&(x=!1,w=-w);let B=r.node(w-1),A=r.index(w-1);if(B.canReplaceWith(A,A,d.type,d.marks))return s.replace(r.before(w),x?i.after(w):t,new y(Bt(n.content,0,n.openStart,u),u,n.openEnd))}}let c=s.steps.length;for(let p=l.length-1;p>=0&&(s.replace(e,t,n),!(s.steps.length>c));p--){let u=l[p];u<0||(e=r.before(u),t=i.after(u))}}function Bt(s,e,t,n,r){if(e<t){let i=s.firstChild;s=s.replaceChild(0,i.copy(Bt(i.content,e+1,t,n,i)))}if(e>n){let i=r.contentMatchAt(0),l=i.fillBefore(s).append(s);s=l.append(i.matchFragment(l).fillBefore(m.empty,!0))}return s}function Fn(s,e,t,n){if(!n.isInline&&e==t&&s.doc.resolve(e).parent.content.size){let r=Nn(s.doc,e,n.type);r!=null&&(e=t=r)}s.replaceRange(e,t,new y(m.from(n),0,0))}function Jn(s,e,t){let n=s.doc.resolve(e),r=s.doc.resolve(t),i=Ft(n,r);for(let l=0;l<i.length;l++){let o=i[l],a=l==i.length-1;if(a&&o==0||n.node(o).type.contentMatch.validEnd)return s.delete(n.start(o),r.end(o));if(o>0&&(a||n.node(o-1).canReplace(n.index(o-1),r.indexAfter(o-1))))return s.delete(n.before(o),r.after(o))}for(let l=1;l<=n.depth&&l<=r.depth;l++)if(e-n.start(l)==n.depth-l&&t>n.end(l)&&r.end(l)-t!=r.depth-l&&n.start(l-1)==r.start(l-1)&&n.node(l-1).canReplace(n.index(l-1),r.index(l-1)))return s.delete(n.before(l),t);s.delete(e,t)}function Ft(s,e){let t=[],n=Math.min(s.depth,e.depth);for(let r=n;r>=0;r--){let i=s.start(r);if(i<s.pos-(s.depth-r)||e.end(r)>e.pos+(e.depth-r)||s.node(r).type.spec.isolating||e.node(r).type.spec.isolating)break;(i==e.start(r)||r==s.depth&&r==e.depth&&s.parent.inlineContent&&e.parent.inlineContent&&r&&e.start(r-1)==i-1)&&t.push(r)}return t}class U extends E{constructor(e,t,n){super(),this.pos=e,this.attr=t,this.value=n}apply(e){let t=e.nodeAt(this.pos);if(!t)return b.fail("No node at attribute step's position");let n=Object.create(null);for(let i in t.attrs)n[i]=t.attrs[i];n[this.attr]=this.value;let r=t.type.create(n,null,t.marks);return b.fromReplace(e,this.pos,this.pos+1,new y(m.from(r),0,t.isLeaf?0:1))}getMap(){return O.empty}invert(e){return new U(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new U(t.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.pos!="number"||typeof t.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new U(t.pos,t.attr,t.value)}}E.jsonID("attr",U);class ee extends E{constructor(e,t){super(),this.attr=e,this.value=t}apply(e){let t=Object.create(null);for(let r in e.attrs)t[r]=e.attrs[r];t[this.attr]=this.value;let n=e.type.create(t,e.content,e.marks);return b.ok(n)}getMap(){return O.empty}invert(e){return new ee(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new ee(t.attr,t.value)}}E.jsonID("docAttr",ee);let j=class extends Error{};j=function s(e){let t=Error.call(this,e);return t.__proto__=s.prototype,t};j.prototype=Object.create(Error.prototype);j.prototype.constructor=j;j.prototype.name="TransformError";class Dn{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new ue}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let t=this.maybeStep(e);if(t.failed)throw new j(t.failed);return this}maybeStep(e){let t=e.apply(this.doc);return t.failed||this.addStep(e,t.doc),t}get docChanged(){return this.steps.length>0}addStep(e,t){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=t}replace(e,t=e,n=y.empty){let r=Fe(this.doc,e,t,n);return r&&this.step(r),this}replaceWith(e,t,n){return this.replace(e,t,new y(m.from(n),0,0))}delete(e,t){return this.replace(e,t,y.empty)}insert(e,t){return this.replaceWith(e,e,t)}replaceRange(e,t,n){return Bn(this,e,t,n),this}replaceRangeWith(e,t,n){return Fn(this,e,t,n),this}deleteRange(e,t){return Jn(this,e,t),this}lift(e,t){return kn(this,e,t),this}join(e,t=1){return In(this,e,t),this}wrap(e,t){return bn(this,e,t),this}setBlockType(e,t=e,n,r=null){return Mn(this,e,t,n,r),this}setNodeMarkup(e,t,n=null,r){return En(this,e,t,n,r),this}setNodeAttribute(e,t,n){return this.step(new U(e,t,n)),this}setDocAttribute(e,t){return this.step(new ee(e,t)),this}addNodeMark(e,t){return this.step(new D(e,t)),this}removeNodeMark(e,t){let n=this.doc.nodeAt(e);if(!n)throw new RangeError("No node at position "+e);if(t instanceof k)t.isInSet(n.marks)&&this.step(new q(e,t));else{let r=n.marks,i,l=[];for(;i=t.isInSet(r);)l.push(new q(e,i)),r=i.removeFromSet(r);for(let o=l.length-1;o>=0;o--)this.step(l[o])}return this}split(e,t=1,n){return Tn(this,e,t,n),this}addMark(e,t,n){return yn(this,e,t,n),this}removeMark(e,t,n){return wn(this,e,t,n),this}clearIncompatible(e,t,n){return Be(this,e,t,n),this}}const ve=Object.create(null);class S{constructor(e,t,n){this.$anchor=e,this.$head=t,this.ranges=n||[new Ae(e.min(t),e.max(t))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let t=0;t<e.length;t++)if(e[t].$from.pos!=e[t].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,t=y.empty){let n=t.content.lastChild,r=null;for(let o=0;o<t.openEnd;o++)r=n,n=n.lastChild;let i=e.steps.length,l=this.ranges;for(let o=0;o<l.length;o++){let{$from:a,$to:h}=l[o],f=e.mapping.slice(i);e.replaceRange(f.map(a.pos),f.map(h.pos),o?y.empty:t),o==0&&et(e,i,(n?n.isInline:r&&r.isTextblock)?-1:1)}}replaceWith(e,t){let n=e.steps.length,r=this.ranges;for(let i=0;i<r.length;i++){let{$from:l,$to:o}=r[i],a=e.mapping.slice(n),h=a.map(l.pos),f=a.map(o.pos);i?e.deleteRange(h,f):(e.replaceRangeWith(h,f,t),et(e,n,t.isInline?-1:1))}}static findFrom(e,t,n=!1){let r=e.parent.inlineContent?new I(e):V(e.node(0),e.parent,e.pos,e.index(),t,n);if(r)return r;for(let i=e.depth-1;i>=0;i--){let l=t<0?V(e.node(0),e.node(i),e.before(i+1),e.index(i),t,n):V(e.node(0),e.node(i),e.after(i+1),e.index(i)+1,t,n);if(l)return l}return null}static near(e,t=1){return this.findFrom(e,t)||this.findFrom(e,-t)||new N(e.node(0))}static atStart(e){return V(e,e,0,0,1)||new N(e)}static atEnd(e){return V(e,e,e.content.size,e.childCount,-1)||new N(e)}static fromJSON(e,t){if(!t||!t.type)throw new RangeError("Invalid input for Selection.fromJSON");let n=ve[t.type];if(!n)throw new RangeError(`No selection type ${t.type} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in ve)throw new RangeError("Duplicate use of selection JSON ID "+e);return ve[e]=t,t.prototype.jsonID=e,t}getBookmark(){return I.between(this.$anchor,this.$head).getBookmark()}}S.prototype.visible=!0;class Ae{constructor(e,t){this.$from=e,this.$to=t}}let Ze=!1;function _e(s){!Ze&&!s.parent.inlineContent&&(Ze=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+s.parent.type.name+")"))}class I extends S{constructor(e,t=e){_e(e),_e(t),super(e,t)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,t){let n=e.resolve(t.map(this.head));if(!n.parent.inlineContent)return S.near(n);let r=e.resolve(t.map(this.anchor));return new I(r.parent.inlineContent?r:n,n)}replace(e,t=y.empty){if(super.replace(e,t),t==y.empty){let n=this.$from.marksAcross(this.$to);n&&e.ensureMarks(n)}}eq(e){return e instanceof I&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new ge(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,t){if(typeof t.anchor!="number"||typeof t.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new I(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,n=t){let r=e.resolve(t);return new this(r,n==t?r:e.resolve(n))}static between(e,t,n){let r=e.pos-t.pos;if((!n||r)&&(n=r>=0?1:-1),!t.parent.inlineContent){let i=S.findFrom(t,n,!0)||S.findFrom(t,-n,!0);if(i)t=i.$head;else return S.near(t,n)}return e.parent.inlineContent||(r==0?e=t:(e=(S.findFrom(e,-n,!0)||S.findFrom(e,n,!0)).$anchor,e.pos<t.pos!=r<0&&(e=t))),new I(e,t)}}S.jsonID("text",I);class ge{constructor(e,t){this.anchor=e,this.head=t}map(e){return new ge(e.map(this.anchor),e.map(this.head))}resolve(e){return I.between(e.resolve(this.anchor),e.resolve(this.head))}}class v extends S{constructor(e){let t=e.nodeAfter,n=e.node(0).resolve(e.pos+t.nodeSize);super(e,n),this.node=t}map(e,t){let{deleted:n,pos:r}=t.mapResult(this.anchor),i=e.resolve(r);return n?S.near(i):new v(i)}content(){return new y(m.from(this.node),0,0)}eq(e){return e instanceof v&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new Je(this.anchor)}static fromJSON(e,t){if(typeof t.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new v(e.resolve(t.anchor))}static create(e,t){return new v(e.resolve(t))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}v.prototype.visible=!1;S.jsonID("node",v);class Je{constructor(e){this.anchor=e}map(e){let{deleted:t,pos:n}=e.mapResult(this.anchor);return t?new ge(n,n):new Je(n)}resolve(e){let t=e.resolve(this.anchor),n=t.nodeAfter;return n&&v.isSelectable(n)?new v(t):S.near(t)}}class N extends S{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,t=y.empty){if(t==y.empty){e.delete(0,e.doc.content.size);let n=S.atStart(e.doc);n.eq(e.selection)||e.setSelection(n)}else super.replace(e,t)}toJSON(){return{type:"all"}}static fromJSON(e){return new N(e)}map(e){return new N(e)}eq(e){return e instanceof N}getBookmark(){return Pn}}S.jsonID("all",N);const Pn={map(){return this},resolve(s){return new N(s)}};function V(s,e,t,n,r,i=!1){if(e.inlineContent)return I.create(s,t);for(let l=n-(r>0?0:1);r>0?l<e.childCount:l>=0;l+=r){let o=e.child(l);if(o.isAtom){if(!i&&v.isSelectable(o))return v.create(s,t-(r<0?o.nodeSize:0))}else{let a=V(s,o,t+r,r<0?o.childCount:0,r,i);if(a)return a}t+=o.nodeSize*r}return null}function et(s,e,t){let n=s.steps.length-1;if(n<e)return;let r=s.steps[n];if(!(r instanceof C||r instanceof T))return;let i=s.mapping.maps[n],l;i.forEach((o,a,h,f)=>{l==null&&(l=f)}),s.setSelection(S.near(s.doc.resolve(l),t))}const tt=1,nt=2,rt=4;class Wn extends Dn{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|tt)&-3,this.storedMarks=null,this}get selectionSet(){return(this.updated&tt)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=nt,this}ensureMarks(e){return k.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&nt)>0}addStep(e,t){super.addStep(e,t),this.updated=this.updated&-3,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,t=!0){let n=this.selection;return t&&(e=e.mark(this.storedMarks||(n.empty?n.$from.marks():n.$from.marksAcross(n.$to)||k.none))),n.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,t,n){let r=this.doc.type.schema;if(t==null)return e?this.replaceSelectionWith(r.text(e),!0):this.deleteSelection();{if(n==null&&(n=t),n=n??t,!e)return this.deleteRange(t,n);let i=this.storedMarks;if(!i){let l=this.doc.resolve(t);i=n==t?l.marks():l.marksAcross(this.doc.resolve(n))}return this.replaceRangeWith(t,n,r.text(e,i)),this.selection.empty||this.setSelection(S.near(this.selection.$to)),this}}setMeta(e,t){return this.meta[typeof e=="string"?e:e.key]=t,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=rt,this}get scrolledIntoView(){return(this.updated&rt)>0}}function it(s,e){return!e||!s?s:s.bind(e)}class Q{constructor(e,t,n){this.name=e,this.init=it(t.init,n),this.apply=it(t.apply,n)}}const Ln=[new Q("doc",{init(s){return s.doc||s.schema.topNodeType.createAndFill()},apply(s){return s.doc}}),new Q("selection",{init(s,e){return s.selection||S.atStart(e.doc)},apply(s){return s.selection}}),new Q("storedMarks",{init(s){return s.storedMarks||null},apply(s,e,t,n){return n.selection.$cursor?s.storedMarks:null}}),new Q("scrollToSelection",{init(){return 0},apply(s,e){return s.scrolledIntoView?e+1:e}})];class be{constructor(e,t){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=Ln.slice(),t&&t.forEach(n=>{if(this.pluginsByKey[n.key])throw new RangeError("Adding different instances of a keyed plugin ("+n.key+")");this.plugins.push(n),this.pluginsByKey[n.key]=n,n.spec.state&&this.fields.push(new Q(n.key,n.spec.state,n))})}}class X{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,t=-1){for(let n=0;n<this.config.plugins.length;n++)if(n!=t){let r=this.config.plugins[n];if(r.spec.filterTransaction&&!r.spec.filterTransaction.call(r,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let t=[e],n=this.applyInner(e),r=null;for(;;){let i=!1;for(let l=0;l<this.config.plugins.length;l++){let o=this.config.plugins[l];if(o.spec.appendTransaction){let a=r?r[l].n:0,h=r?r[l].state:this,f=a<t.length&&o.spec.appendTransaction.call(o,a?t.slice(a):t,h,n);if(f&&n.filterTransaction(f,l)){if(f.setMeta("appendedTransaction",e),!r){r=[];for(let c=0;c<this.config.plugins.length;c++)r.push(c<l?{state:n,n:t.length}:{state:this,n:0})}t.push(f),n=n.applyInner(f),i=!0}r&&(r[l]={state:n,n:t.length})}}if(!i)return{state:n,transactions:t}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let t=new X(this.config),n=this.config.fields;for(let r=0;r<n.length;r++){let i=n[r];t[i.name]=i.apply(e,this[i.name],this,t)}return t}get tr(){return new Wn(this)}static create(e){let t=new be(e.doc?e.doc.type.schema:e.schema,e.plugins),n=new X(t);for(let r=0;r<t.fields.length;r++)n[t.fields[r].name]=t.fields[r].init(e,n);return n}reconfigure(e){let t=new be(this.schema,e.plugins),n=t.fields,r=new X(t);for(let i=0;i<n.length;i++){let l=n[i].name;r[l]=this.hasOwnProperty(l)?this[l]:n[i].init(e,r)}return r}toJSON(e){let t={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(t.storedMarks=this.storedMarks.map(n=>n.toJSON())),e&&typeof e=="object")for(let n in e){if(n=="doc"||n=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let r=e[n],i=r.spec.state;i&&i.toJSON&&(t[n]=i.toJSON.call(r,this[r.key]))}return t}static fromJSON(e,t,n){if(!t)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let r=new be(e.schema,e.plugins),i=new X(r);return r.fields.forEach(l=>{if(l.name=="doc")i.doc=z.fromJSON(e.schema,t.doc);else if(l.name=="selection")i.selection=S.fromJSON(i.doc,t.selection);else if(l.name=="storedMarks")t.storedMarks&&(i.storedMarks=t.storedMarks.map(e.schema.markFromJSON));else{if(n)for(let o in n){let a=n[o],h=a.spec.state;if(a.key==l.name&&h&&h.fromJSON&&Object.prototype.hasOwnProperty.call(t,o)){i[l.name]=h.fromJSON.call(a,e,t[o],i);return}}i[l.name]=l.init(e,i)}}),i}}function Jt(s,e,t){for(let n in s){let r=s[n];r instanceof Function?r=r.bind(e):n=="handleDOMEvents"&&(r=Jt(r,e,{})),t[n]=r}return t}class gr{constructor(e){this.spec=e,this.props={},e.props&&Jt(e.props,this,this.props),this.key=e.key?e.key.key:Dt("plugin")}getState(e){return e[this.key]}}const Me=Object.create(null);function Dt(s){return s in Me?s+"$"+ ++Me[s]:(Me[s]=0,s+"$")}class yr{constructor(e="key"){this.key=Dt(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const Pt=(s,e)=>s.selection.empty?!1:(e&&e(s.tr.deleteSelection().scrollIntoView()),!0);function qn(s,e){let{$cursor:t}=s.selection;return!t||(e?!e.endOfTextblock("backward",s):t.parentOffset>0)?null:t}const Vn=(s,e,t)=>{let n=qn(s,t);if(!n)return!1;let r=Wt(n);if(!r){let l=n.blockRange(),o=l&&de(l);return o==null?!1:(e&&e(s.tr.lift(l,o).scrollIntoView()),!0)}let i=r.nodeBefore;if(qt(s,r,e,-1))return!0;if(n.parent.content.size==0&&(H(i,"end")||v.isSelectable(i)))for(let l=n.depth;;l--){let o=Fe(s.doc,n.before(l),n.after(l),y.empty);if(o&&o.slice.size<o.to-o.from){if(e){let a=s.tr.step(o);a.setSelection(H(i,"end")?S.findFrom(a.doc.resolve(a.mapping.map(r.pos,-1)),-1):v.create(a.doc,r.pos-i.nodeSize)),e(a.scrollIntoView())}return!0}if(l==1||n.node(l-1).childCount>1)break}return i.isAtom&&r.depth==n.depth-1?(e&&e(s.tr.delete(r.pos-i.nodeSize,r.pos).scrollIntoView()),!0):!1};function H(s,e,t=!1){for(let n=s;n;n=e=="start"?n.firstChild:n.lastChild){if(n.isTextblock)return!0;if(t&&n.childCount!=1)return!1}return!1}const $n=(s,e,t)=>{let{$head:n,empty:r}=s.selection,i=n;if(!r)return!1;if(n.parent.isTextblock){if(t?!t.endOfTextblock("backward",s):n.parentOffset>0)return!1;i=Wt(n)}let l=i&&i.nodeBefore;return!l||!v.isSelectable(l)?!1:(e&&e(s.tr.setSelection(v.create(s.doc,i.pos-l.nodeSize)).scrollIntoView()),!0)};function Wt(s){if(!s.parent.type.spec.isolating)for(let e=s.depth-1;e>=0;e--){if(s.index(e)>0)return s.doc.resolve(s.before(e+1));if(s.node(e).type.spec.isolating)break}return null}function Un(s,e){let{$cursor:t}=s.selection;return!t||(e?!e.endOfTextblock("forward",s):t.parentOffset<t.parent.content.size)?null:t}const jn=(s,e,t)=>{let n=Un(s,t);if(!n)return!1;let r=Lt(n);if(!r)return!1;let i=r.nodeAfter;if(qt(s,r,e,1))return!0;if(n.parent.content.size==0&&(H(i,"start")||v.isSelectable(i))){let l=Fe(s.doc,n.before(),n.after(),y.empty);if(l&&l.slice.size<l.to-l.from){if(e){let o=s.tr.step(l);o.setSelection(H(i,"start")?S.findFrom(o.doc.resolve(o.mapping.map(r.pos)),1):v.create(o.doc,o.mapping.map(r.pos))),e(o.scrollIntoView())}return!0}}return i.isAtom&&r.depth==n.depth-1?(e&&e(s.tr.delete(r.pos,r.pos+i.nodeSize).scrollIntoView()),!0):!1},Hn=(s,e,t)=>{let{$head:n,empty:r}=s.selection,i=n;if(!r)return!1;if(n.parent.isTextblock){if(t?!t.endOfTextblock("forward",s):n.parentOffset<n.parent.content.size)return!1;i=Lt(n)}let l=i&&i.nodeAfter;return!l||!v.isSelectable(l)?!1:(e&&e(s.tr.setSelection(v.create(s.doc,i.pos)).scrollIntoView()),!0)};function Lt(s){if(!s.parent.type.spec.isolating)for(let e=s.depth-1;e>=0;e--){let t=s.node(e);if(s.index(e)+1<t.childCount)return s.doc.resolve(s.after(e+1));if(t.type.spec.isolating)break}return null}const wr=(s,e)=>{let t=s.selection,n=t instanceof v,r;if(n){if(t.node.isTextblock||!me(s.doc,t.from))return!1;r=t.from}else if(r=At(s.doc,t.from,-1),r==null)return!1;if(e){let i=s.tr.join(r);n&&i.setSelection(v.create(i.doc,r-s.doc.resolve(r).nodeBefore.nodeSize)),e(i.scrollIntoView())}return!0},xr=(s,e)=>{let t=s.selection,n;if(t instanceof v){if(t.node.isTextblock||!me(s.doc,t.to))return!1;n=t.to}else if(n=At(s.doc,t.to,1),n==null)return!1;return e&&e(s.tr.join(n).scrollIntoView()),!0},kr=(s,e)=>{let{$from:t,$to:n}=s.selection,r=t.blockRange(n),i=r&&de(r);return i==null?!1:(e&&e(s.tr.lift(r,i).scrollIntoView()),!0)},Gn=(s,e)=>{let{$head:t,$anchor:n}=s.selection;return!t.parent.type.spec.code||!t.sameParent(n)?!1:(e&&e(s.tr.insertText(`
`).scrollIntoView()),!0)};function De(s){for(let e=0;e<s.edgeCount;e++){let{type:t}=s.edge(e);if(t.isTextblock&&!t.hasRequiredAttrs())return t}return null}const Kn=(s,e)=>{let{$head:t,$anchor:n}=s.selection;if(!t.parent.type.spec.code||!t.sameParent(n))return!1;let r=t.node(-1),i=t.indexAfter(-1),l=De(r.contentMatchAt(i));if(!l||!r.canReplaceWith(i,i,l))return!1;if(e){let o=t.after(),a=s.tr.replaceWith(o,o,l.createAndFill());a.setSelection(S.near(a.doc.resolve(o),1)),e(a.scrollIntoView())}return!0},Qn=(s,e)=>{let t=s.selection,{$from:n,$to:r}=t;if(t instanceof N||n.parent.inlineContent||r.parent.inlineContent)return!1;let i=De(r.parent.contentMatchAt(r.indexAfter()));if(!i||!i.isTextblock)return!1;if(e){let l=(!n.parentOffset&&r.index()<r.parent.childCount?n:r).pos,o=s.tr.insert(l,i.createAndFill());o.setSelection(I.create(o.doc,l+1)),e(o.scrollIntoView())}return!0},Xn=(s,e)=>{let{$cursor:t}=s.selection;if(!t||t.parent.content.size)return!1;if(t.depth>1&&t.after()!=t.end(-1)){let i=t.before();if($(s.doc,i))return e&&e(s.tr.split(i).scrollIntoView()),!0}let n=t.blockRange(),r=n&&de(n);return r==null?!1:(e&&e(s.tr.lift(n,r).scrollIntoView()),!0)};function Yn(s){return(e,t)=>{let{$from:n,$to:r}=e.selection;if(e.selection instanceof v&&e.selection.node.isBlock)return!n.parentOffset||!$(e.doc,n.pos)?!1:(t&&t(e.tr.split(n.pos).scrollIntoView()),!0);if(!n.depth)return!1;let i=[],l,o,a=!1,h=!1;for(let u=n.depth;;u--)if(n.node(u).isBlock){a=n.end(u)==n.pos+(n.depth-u),h=n.start(u)==n.pos-(n.depth-u),o=De(n.node(u-1).contentMatchAt(n.indexAfter(u-1))),i.unshift(a&&o?{type:o}:null),l=u;break}else{if(u==1)return!1;i.unshift(null)}let f=e.tr;(e.selection instanceof I||e.selection instanceof N)&&f.deleteSelection();let c=f.mapping.map(n.pos),p=$(f.doc,c,i.length,i);if(p||(i[0]=o?{type:o}:null,p=$(f.doc,c,i.length,i)),!p)return!1;if(f.split(c,i.length,i),!a&&h&&n.node(l).type!=o){let u=f.mapping.map(n.before(l)),d=f.doc.resolve(u);o&&n.node(l-1).canReplaceWith(d.index(),d.index()+1,o)&&f.setNodeMarkup(f.mapping.map(n.before(l)),o)}return t&&t(f.scrollIntoView()),!0}}const Zn=Yn(),Sr=(s,e)=>{let{$from:t,to:n}=s.selection,r,i=t.sharedDepth(n);return i==0?!1:(r=t.before(i),e&&e(s.tr.setSelection(v.create(s.doc,r))),!0)},_n=(s,e)=>(e&&e(s.tr.setSelection(new N(s.doc))),!0);function er(s,e,t){let n=e.nodeBefore,r=e.nodeAfter,i=e.index();return!n||!r||!n.type.compatibleContent(r.type)?!1:!n.content.size&&e.parent.canReplace(i-1,i)?(t&&t(s.tr.delete(e.pos-n.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(i,i+1)||!(r.isTextblock||me(s.doc,e.pos))?!1:(t&&t(s.tr.join(e.pos).scrollIntoView()),!0)}function qt(s,e,t,n){let r=e.nodeBefore,i=e.nodeAfter,l,o,a=r.type.spec.isolating||i.type.spec.isolating;if(!a&&er(s,e,t))return!0;let h=!a&&e.parent.canReplace(e.index(),e.index()+1);if(h&&(l=(o=r.contentMatchAt(r.childCount)).findWrapping(i.type))&&o.matchType(l[0]||i.type).validEnd){if(t){let u=e.pos+i.nodeSize,d=m.empty;for(let x=l.length-1;x>=0;x--)d=m.from(l[x].create(null,d));d=m.from(r.copy(d));let g=s.tr.step(new T(e.pos-1,u,e.pos,u,new y(d,1,0),l.length,!0)),w=g.doc.resolve(u+2*l.length);w.nodeAfter&&w.nodeAfter.type==r.type&&me(g.doc,w.pos)&&g.join(w.pos),t(g.scrollIntoView())}return!0}let f=i.type.spec.isolating||n>0&&a?null:S.findFrom(e,1),c=f&&f.$from.blockRange(f.$to),p=c&&de(c);if(p!=null&&p>=e.depth)return t&&t(s.tr.lift(c,p).scrollIntoView()),!0;if(h&&H(i,"start",!0)&&H(r,"end")){let u=r,d=[];for(;d.push(u),!u.isTextblock;)u=u.lastChild;let g=i,w=1;for(;!g.isTextblock;g=g.firstChild)w++;if(u.canReplace(u.childCount,u.childCount,g.content)){if(t){let x=m.empty;for(let A=d.length-1;A>=0;A--)x=m.from(d[A].copy(x));let B=s.tr.step(new T(e.pos-d.length,e.pos+i.nodeSize,e.pos+w,e.pos+i.nodeSize-w,new y(x,d.length,0),0,!0));t(B.scrollIntoView())}return!0}}return!1}function Vt(s){return function(e,t){let n=e.selection,r=s<0?n.$from:n.$to,i=r.depth;for(;r.node(i).isInline;){if(!i)return!1;i--}return r.node(i).isTextblock?(t&&t(e.tr.setSelection(I.create(e.doc,s<0?r.start(i):r.end(i)))),!0):!1}}const tr=Vt(-1),nr=Vt(1);function vr(s,e=null){return function(t,n){let{$from:r,$to:i}=t.selection,l=r.blockRange(i),o=l&&Tt(l,s,e);return o?(n&&n(t.tr.wrap(l,o).scrollIntoView()),!0):!1}}function br(s,e=null){return function(t,n){let r=!1;for(let i=0;i<t.selection.ranges.length&&!r;i++){let{$from:{pos:l},$to:{pos:o}}=t.selection.ranges[i];t.doc.nodesBetween(l,o,(a,h)=>{if(r)return!1;if(!(!a.isTextblock||a.hasMarkup(s,e)))if(a.type==s)r=!0;else{let f=t.doc.resolve(h),c=f.index();r=f.parent.canReplaceWith(c,c+1,s)}})}if(!r)return!1;if(n){let i=t.tr;for(let l=0;l<t.selection.ranges.length;l++){let{$from:{pos:o},$to:{pos:a}}=t.selection.ranges[l];i.setBlockType(o,a,s,e)}n(i.scrollIntoView())}return!0}}function rr(s,e,t,n){for(let r=0;r<e.length;r++){let{$from:i,$to:l}=e[r],o=i.depth==0?s.inlineContent&&s.type.allowsMarkType(t):!1;if(s.nodesBetween(i.pos,l.pos,(a,h)=>{if(o||!n&&a.isAtom&&a.isInline&&h>=i.pos&&h+a.nodeSize<=l.pos)return!1;o=a.inlineContent&&a.type.allowsMarkType(t)}),o)return!0}return!1}function ir(s){let e=[];for(let t=0;t<s.length;t++){let{$from:n,$to:r}=s[t];n.doc.nodesBetween(n.pos,r.pos,(i,l)=>{if(i.isAtom&&i.content.size&&i.isInline&&l>=n.pos&&l+i.nodeSize<=r.pos)return l+1>n.pos&&e.push(new Ae(n,n.doc.resolve(l+1))),n=n.doc.resolve(l+1+i.content.size),!1}),n.pos<r.pos&&e.push(new Ae(n,r))}return e}function Mr(s,e=null,t){let n=(t&&t.removeWhenPresent)!==!1,r=(t&&t.enterInlineAtoms)!==!1,i=!(t&&t.includeWhitespace);return function(l,o){let{empty:a,$cursor:h,ranges:f}=l.selection;if(a&&!h||!rr(l.doc,f,s,r))return!1;if(o)if(h)s.isInSet(l.storedMarks||h.marks())?o(l.tr.removeStoredMark(s)):o(l.tr.addStoredMark(s.create(e)));else{let c,p=l.tr;r||(f=ir(f)),n?c=!f.some(u=>l.doc.rangeHasMark(u.$from.pos,u.$to.pos,s)):c=!f.every(u=>{let d=!1;return p.doc.nodesBetween(u.$from.pos,u.$to.pos,(g,w,x)=>{if(d)return!1;d=!s.isInSet(g.marks)&&!!x&&x.type.allowsMarkType(s)&&!(g.isText&&/^\s*$/.test(g.textBetween(Math.max(0,u.$from.pos-w),Math.min(g.nodeSize,u.$to.pos-w))))}),!d});for(let u=0;u<f.length;u++){let{$from:d,$to:g}=f[u];if(!c)p.removeMark(d.pos,g.pos,s);else{let w=d.pos,x=g.pos,B=d.nodeAfter,A=g.nodeBefore,We=i&&B&&B.isText?/^\s*/.exec(B.text)[0].length:0,Ut=i&&A&&A.isText?/\s*$/.exec(A.text)[0].length:0;w+We<x&&(w+=We,x-=Ut),p.addMark(w,x,s.create(e))}}o(p.scrollIntoView())}return!0}}function Pe(...s){return function(e,t,n){for(let r=0;r<s.length;r++)if(s[r](e,t,n))return!0;return!1}}let Ce=Pe(Pt,Vn,$n),st=Pe(Pt,jn,Hn);const F={Enter:Pe(Gn,Qn,Xn,Zn),"Mod-Enter":Kn,Backspace:Ce,"Mod-Backspace":Ce,"Shift-Backspace":Ce,Delete:st,"Mod-Delete":st,"Mod-a":_n},$t={"Ctrl-h":F.Backspace,"Alt-Backspace":F["Mod-Backspace"],"Ctrl-d":F.Delete,"Ctrl-Alt-Backspace":F["Mod-Delete"],"Alt-Delete":F["Mod-Delete"],"Alt-d":F["Mod-Delete"],"Ctrl-a":tr,"Ctrl-e":nr};for(let s in F)$t[s]=F[s];const sr=typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform?os.platform()=="darwin":!1,Cr=sr?$t:F;function Er(s,e=null){return function(t,n){let{$from:r,$to:i}=t.selection,l=r.blockRange(i);if(!l)return!1;let o=n?t.tr:null;return lr(o,l,s,e)?(n&&n(o.scrollIntoView()),!0):!1}}function lr(s,e,t,n=null){let r=!1,i=e,l=e.$from.doc;if(e.depth>=2&&e.$from.node(e.depth-1).type.compatibleContent(t)&&e.startIndex==0){if(e.$from.index(e.depth-1)==0)return!1;let a=l.resolve(e.start-2);i=new Te(a,a,e.depth),e.endIndex<e.parent.childCount&&(e=new Te(e.$from,l.resolve(e.$to.end(e.depth)),e.depth)),r=!0}let o=Tt(i,t,n,e);return o?(s&&or(s,e,o,r,t),!0):!1}function or(s,e,t,n,r){let i=m.empty;for(let f=t.length-1;f>=0;f--)i=m.from(t[f].type.create(t[f].attrs,i));s.step(new T(e.start-(n?2:0),e.end,e.start,e.end,new y(i,0,0),t.length,!0));let l=0;for(let f=0;f<t.length;f++)t[f].type==r&&(l=f+1);let o=t.length-l,a=e.start+t.length-(n?2:0),h=e.parent;for(let f=e.startIndex,c=e.endIndex,p=!0;f<c;f++,p=!1)!p&&$(s.doc,a,o)&&(s.split(a,o),a+=2*o),a+=h.child(f).nodeSize;return s}function Tr(s,e){return function(t,n){let{$from:r,$to:i,node:l}=t.selection;if(l&&l.isBlock||r.depth<2||!r.sameParent(i))return!1;let o=r.node(-1);if(o.type!=s)return!1;if(r.parent.content.size==0&&r.node(-1).childCount==r.indexAfter(-1)){if(r.depth==3||r.node(-3).type!=s||r.index(-2)!=r.node(-2).childCount-1)return!1;if(n){let c=m.empty,p=r.index(-1)?1:r.index(-2)?2:3;for(let x=r.depth-p;x>=r.depth-3;x--)c=m.from(r.node(x).copy(c));let u=r.indexAfter(-1)<r.node(-2).childCount?1:r.indexAfter(-2)<r.node(-3).childCount?2:3;c=c.append(m.from(s.createAndFill()));let d=r.before(r.depth-(p-1)),g=t.tr.replace(d,r.after(-u),new y(c,4-p,0)),w=-1;g.doc.nodesBetween(d,g.doc.content.size,(x,B)=>{if(w>-1)return!1;x.isTextblock&&x.content.size==0&&(w=B+1)}),w>-1&&g.setSelection(S.near(g.doc.resolve(w))),n(g.scrollIntoView())}return!0}let a=i.pos==r.end()?o.contentMatchAt(0).defaultType:null,h=t.tr.delete(r.pos,i.pos),f=a?[null,{type:a}]:void 0;return $(h.doc,r.pos,2,f)?(n&&n(h.split(r.pos,2,f).scrollIntoView()),!0):!1}}export{N as A,Re as D,X as E,m as F,k as M,v as N,gr as P,ar as S,I as T,S as a,Cr as b,y as c,ce as d,mr as e,fr as f,yr as g,ue as h,Tt as i,me as j,Pe as k,wr as l,xr as m,kr as n,Mr as o,vr as p,Kn as q,Tr as r,Sr as s,hr as t,br as u,cr as v,Er as w,dr as x,pr as y,ur as z};
